(()=>{const style=`\n  .simple-commenter-modebox {\n    display: inline-flex;\n    flex-direction: row;\n    background: white;\n    border-radius: 6px;\n    border: 1px solid #000;\n    overflow: hidden;\n    padding-left: -1px;\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\n  }\n\n  .simple-commenter-modebox-container {\n    position: fixed;\n    bottom: 1.25em;\n    right: 1.25em;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 8px;\n    z-index: 10112;\n  }\n\n  .simple-commenter-comment-count {\n    font-size: 14px; /* Equivalent to Tailwind's text-sm */\n    color: #000; /* Equivalent to Tailwind's text-gray-600 */\n    margin: 0;\n    line-height: 1.5;\n    font-family: "Poppins", sans-serif!important; \n  }\n\n  .simple-commenter-comment-count-bold {\n    font-weight: 700; /* Equivalent to Tailwind's font-bold */\n  }\n\n  /* Comment List Container */\n  .simple-commenter-comment-list {\n    position: relative;\n    overflow: hidden;\n    width: 600px;\n    max-width: 90vw;\n    background: white;\n    border-radius: 12px;\n    border: 1px solid rgb(229 231 235);\n    padding: 8px 12px;\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.05);\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    z-index: 1103;\n  }\n\n  .simple-commenter-container-smaller {\n    width: 450px;\n    max-width: 90vw;\n  }\n\n  /* Close Button */\n  .simple-commenter-close-button {\n    position: absolute; \n    top:0; \n    right:0; \n    cursor: pointer!important; \n    padding-top: 8px!important; \n    padding-right: 8px!important;\n    stroke: rgb(55 65 81);\n    border-width: 0!important;\n    background: transparent;\n    background-color: transparent!important;\n  }\n\n  .simple-commenter-close-button:hover {\n    opacity: 0.7;\n    box-shadow: none;\n  }\n\n  /* Comments Wrapper */\n  .simple-commenter-comments-wrapper {\n    display: flex;\n    flex-direction: column;\n    font-family: "Poppins", sans-serif!important; \n    padding: 0em 12px;\n    max-height: 300px;\n    overflow-y: auto;\n  }\n\n  /* Individual Comment Item */\n  .simple-commenter-comment-item {\n    background: #f7f7f7;\n    margin-bottom: 8px;\n    border-radius: 8px;\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    transition: background-color 0.2s ease-in-out;\n  }\n\n  /* Comment Text */\n  .simple-commenter-comment-text {\n    font-size: 16px;\n    font-weight: 500;\n    color: #626262;\n  }\n\n  /* Comment Date */\n  .simple-commenter-comment-meta {\n    font-size: 12px!important;\n    color: #7E7E7E;\n    text-align: right;\n    display: flex;\n    /* justify-content: space-between; */\n    font-family: "Poppins", sans-serif!important;\n    align-items: stretch;\n    stroke: rgb(55, 65, 81);\n    margin: 0!important;\n    gap: 0.325em;\n    background-color: transparent!important;\n    border:none!important;\n    padding:0px!important;\n    min-height: auto;\n  }\n\n  .simple-commenter-p-2 {\n    padding: 8px!important;\n  }\n\n  .simple-commenter-comment-meta-button {\n    border: transparent!important;;\n    background: transparent!important;\n    background-color: transparent !important;\n    padding: 0!important;\n    text-decoration: underline!important;\n    border:none!important;\n    border-style: none !important;\n    position: relative;\n    margin: 0;\n    min-height: auto;\n  }\n  \n  .simple-commenter-comment-meta-button:hover {\n    text-decoration: underline;\n    background-color: transparent!important;\n    border:none!important;\n  }\n\n  .simple-commenter-comment-meta-container {\n    align-content: center;\n    flex-wrap: wrap;\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  .simple-commenter-space-between {\n    display: flex;\n    justify-content: space-between;\n  }\n\n  .simple-commenter-align-center {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  /* No Comments Message */\n  .simple-commenter-no-comments {\n    text-align: center;\n    font-size: 16px;\n    color: #9E9E9E;\n  }\n\n  /* Header line: contains name and date */\n  .simple-commenter-comment-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  /* Name styling */\n  .simple-commenter-comment-name {\n    font-size: 14px; /* Slightly larger */\n    font-weight: bold;\n    color: #9E9E9E;\n  }\n\n  /* Date styling */\n  .simple-commenter-comment-date {\n    font-size: 12px;\n    color: #9E9E9E;\n  }\n\n    /* Date styling */\n  .simple-commenter-comment-date-large {\n    font-size: 0.85em!important;\n    color: #9E9E9E;\n  }\n  .simple-commenter-buttons-container {\n    display: flex;\n    align-items: flex-end;\n    gap: 4px;\n  }\n\n  .simple-commenter-reply-buttons-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-end;\n  }\n\n  .simple-commenter-comment-list-button {\n    display: flex;\n    align-items: center;\n    gap: 6px; /* Equivalent to Tailwind's gap-1.5 */\n    border-radius: 9999px!important; /* Fully rounded (rounded-full) */\n    border: 1px solid #e5e7eb!important; /* Equivalent to Tailwind's border-gray-200 */\n    background-color: #ffffff!important; /* White background */\n    padding: 2px 8px!important; /* Equivalent to px-2 py-0.5 */\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.05);\n    cursor: pointer!important;\n    transition: background-color 0.2s ease-in-out;\n    color: black!important;   \n    stroke: black; \n    border:none!important;\n    line-height: 0px!important;\n    margin: 0;\n    min-height: auto;\n  }\n\n  .simple-commenter-comment-list-button:hover {\n    background-color: #f9fafb; /* Slight hover effect */\n    border:none;\n  }\n\n  .simple-commenter-user-button {\n      padding: 4px!important;\n  }\n\n\n  .simple-commenter-modebox > button {\n    padding: 8px 16px;\n    cursor: pointer;\n    background: white;\n    text-color: black;\n    stroke: rgb(55 65 81);\n    border-width: 0;\n    border-style: solid;\n    border-radius: 0!important;\n    border-color: #000;\n    margin: 0;\n    min-height: auto;\n  }\n\n  .simple-commenter-border {\n    border:solid!important;\n    border-left-width: 1px !important;\n    border-right-width: 0px !important;\n    border-top-width: 0px !important;\n    border-bottom-width: 0px !important;\n    border-color: black!important;\n  }\n\n  .simple-commenter-modebox > button:hover {\n    background-color: #F7F7F7;\n    stroke: rgb(55 65 81);\n    border: none;\n        border-left-width: 1px !important;\n    border-right-width: 0px !important;\n    border-top-width: 0px !important;\n    border-bottom-width: 0px !important;\n  }\n\n  .simple-commenter-user-modebox {\n    border-radius: 100em;\n  }\n\n    .simple-commenter-user-modebox > button {\n    padding: 12px;\n  }\n\n  .simple-commenter-disabled-button {\n    background-color: #F7D070!important;\n    box-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.08);\n  }\n\n  .simple-commenter-view-button {\n    background-color: #F7D070!important;\n    box-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.08);\n  }\n\n  .simple-commenter-active-button {\n    background-color: #F7D070!important;\n    box-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.08);\n    border-color: #000;\n  }    \n\n  .simple-commenter-overlay {\n    position: absolute; \n    z-index: 10099; \n    background-color: rgba(249, 268, 212);\n    opacity: 0.5!important;\n    display: none; \n    pointer-events: none;\n    border-radius: 0.16px; \n  }\n\n  .simple-commenter-active {\n    animation: fadeIn 0.4s forwards;\n  }\n\n  .simple-commenter-active-state {\n    background-color: #f7f7f7!important;\n  }\n\n  .simple-commenter-container {\n    display:flex; \n    align-items: stretch;\n    flex-direction:column;\n    align-items: stretch;\n    background:white; \n    border-radius: 12px; \n    border: 1px solid;\n    border-color: rgb(229 231 235);\n    min-width: 22em;\n    font-family: "Poppins", sans-serif!important; \n    font-size: 16px;\n    line-height: 1.25em; \n    background: rgb(243 244 246); \n    color: rgb(17 24 39);\n    z-index: 10101;\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\n  }\n\n  .simple-commenter-textarea {\n    min-height: 6em!important;\n    padding: 0em!important;\n    border: none; /* Removes the border */\n    background: transparent;\n    resize: vertical; /* Allows vertical resizing by the user */\n    outline: none; /* Prevents the outline on focus */\n    line-height: 1.5em!important; /* 24px */\n    font-family: "Poppins", sans-serif!important; \n    font-size: 16px!important;\n    border-style: none !important;\n    border-radius: 0 !important;\n    line-height: unset;\n    box-shadow: none;\n  }\n\n  .simple-commenter-textarea::placeholder {\n    color: rgb(75 85 99);\n  }\n  \n  .simple-commenter-textarea:focus {\n    outline: none; \n    border: none;\n    --tw-ring-color: transparent; /* Removes the focus ring */\n    box-shadow: none;\n  }\n  \n  .simple-commenter-button {\n    padding: 4px 10px!important;\n    cursor: pointer!important; \n    background: white; \n    background-color: white!important;\n    color: rgb(55 65 81)!important; \n    border-radius: 9999em!important;\n    font-weight: 500!important;\n    font-size: 14px!important; /* 14px */\n    line-height: 1.25em!important; /* 20px */ \n    border-width: 1px!important;\n    border-color: rgb(209 213 219)!important;\n    border-style: solid!important;\n    align-self: flex-end;\n    text-decoration: none !important;\n    text-transform: none !important;\n    letter-spacing: normal !important;\n    font-family: "Poppins", sans-serif !important;\n    margin: 0;\n    min-height: auto;\n  }\n\n  .simple-commenter-button:hover {\n    background: #F7F7F7!important;\n    border-color: rgba(34, 34, 34, 0.1) !important;\n    box-shadow: none;\n  }\n\n  .simple-commenter-button-green {\n    padding: 4px 10px!important;\n    cursor: pointer!important; \n    background: white!important; \n    background-color: white!important;\n    color: rgb(55 65 81)!important;\n    border-radius: 9999em!important;\n    font-weight: 500!important;\n    font-family: "Poppins", sans-serif!important;\n    font-size: 16px!important; /* 14px */\n    line-height: 1.25em!important; /* 20px */ \n    border-width: 1px!important;\n    border-color: #E1E1E1!important;\n    border-style: solid!important;\n    align-self: flex-end;\n    text-shadow: none!important;\n    text-transform: none!important;\n    letter-spacing: normal!important;\n    text-decoration: none!important;\n    margin: 0!important;\n  }\n\n  .simple-commenter-button-green:hover {\n    background: #F7F7F7!important;\n    border-color: rgba(34, 34, 34, 0.1) !important;\n    border:none;\n    box-shadow: none;\n  }\n\n  .simple-commenter-button-red {\n    background: transparent!important;\n    padding: 4px 10px!important;\n    cursor: pointer!important; \n    color: rgb(55 65 81)!important;\n    border-radius: 9999em!important;\n    font-weight: 500!important;\n    font-family: "Poppins", sans-serif!important;\n    font-size: 16px!important; /* 14px */\n    line-height: 1.25em!important; /* 20px */ \n    border-style: solid!important;\n    border-width: 1px!important;\n    border-color: transparent!important;\n    align-self: flex-end;\n  }\n\n  .simple-commenter-button-red:hover {\n    background: #FFEEEE!important;\n    border-color: rgba(214, 69, 69, 0.1) !important;\n    color: #D64545!important;\n  }\n\n  .simple-commenter-button-small {\n    padding: 2px 8px !important; /* px-2 py-0.5 */\n    font-size: 14px !important; /* text-sm (14px) */\n    line-height: 1.25em !important; /* leading-5 (20px) */\n  } \n\n  .simple-commenter-comment-box {\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n    border-radius: 12px;\n    border: 1px solid;\n    border-color: rgb(229 231 235);\n    max-width: 30em;\n    min-width: 20em;\n    min-height: 50px;\n    font-family: "Poppins", sans-serif!important;\n    font-size: 16px; /* 16px */\n    line-height: 1.5em; /* 24px */\n    background: white;\n    color: black;\n    z-index: 10102;\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\n  }\n\n  .simple-commenter-comment-container {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    padding: 8px 12px;\n    gap: 12px;\n    font-family: "Poppins", sans-serif!important;\n    background: white;\n    color: #000;\n    margin: 0;\n    font-size: 16px; /* 14px */\n  }\n\n  .simple-commenter-border-radius-top {\n    border-radius: 12px 12px 0 0\n  }\n\n  .simple-commenter-border-radius-bottom {\n    border-radius: 0 0 12px 12px;\n  }\n\n\n  .simple-commenter-flex-row {\n    flex-direction: row!important;\n    align-items: center!important;\n    justify-content: space-between!important;\n  }\n\n  .simple-commenter-flex-1 {\n    flex: 1 1 0%!important;\n  }\n\n  .simple-commenter-gap-0 {\n    gap:0;  \n  }\n\n  .simple-commenter-gap-1{\n    gap:2px;\n    justify-content: flex-start;\n  }\n\n  .simple-commenter-list-buttons {\n    display: flex;\n    justify-content: flex-end;\n    gap: 4px;\n    padding: 8px 12px;\n    background: #F7F7F7;\n    margin-top: 4px;\n  }\n\n  .simple-commenter-border-0 {\n    border: 0;\n  }\n\n  .simple-commenter-bg-gray-50 {\n    background: #F7F7F7;\n  }\n\n  .simple-commenter-title {\n    font-weight: 500!important;\n    font-size: 16px;\n    font-family: "Poppins", sans-serif!important;\n    color: #000 !important;\n    margin-top: 0;\n    margin-bottom: 0;\n  }\n\n  .simple-commenter-title-bold {\n    font-weight: 500!important;\n    color: #222222 !important;\n  }\n\n  .simple-commenter-text {\n    font-weight: 400!important;\n  }\n\n  .simple-commenter-reply-container {\n    display: flex;\n    flex-direction: column;\n    border-radius: 8px;\n    padding: 8px;\n    background: #F7F7F7;\n  }\n  .simple-commenter-reply-container textarea {\n    padding: 0em!important;\n    min-height: auto!important;\n    background: transparent;\n  } -\n\n  .simple-commenter-comment-box span {\n    color: rgb(55 65 81);\n    font-size: 16px; /* 14px */\n    line-height: 1.25em; /* 20px */\n    color: rgb(107 114 128);\n  }\n\n  .simple-commenter-comment-box-menu { \n    padding: 8px;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    gap: 6px;\n    background: #F7F7F7; \n    flex-wrap: wrap;\n    align-content: center;\n    border-radius: 0 0 12px 12px;\n  }\n\n  .simple-commenter-comment-box-buttons { \n    display: flex;\n    flex-direction: row;    \n    gap: 4px;\n  }\n\n  .simple-commenter-replies-wrapper {\n    animation-fill-mode: backwards;\n    font-family: "Poppins", sans-serif!important; \n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    margin-top: 8px\n  }\n\n  .simple-commenter-replies-wrapper-p {\n    padding-bottom: 8px;\n    font-weight: 400;\n  }\n\n  .simple-commenter-reply {\n    padding: 8px;\n    border-radius: 8px;\n    background: #F7F7F7;\n  }\n\n  .simple-commenter-reply p {\n    margin: 0;\n    font-size: 16px; /* 14px */\n  }\n\n  .simple-commenter-reply-date {\n    font-size: 12px;\n    color: rgb(107, 114, 128);\n  }\n\n  .simple-commenter-comment-marker {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: absolute;\n    padding: 8px;\n    margin: 8px;\n    border-radius: 50%;\n    background: #4098D7;\n    cursor: pointer;\n    z-index: 10099;\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\n    stroke: rgb(240 249 255);\n  }\n\n  .simple-commenter-x-button {\n    position:absolute; \n    top:0; \n    right:0; \n    cursor: pointer!important; \n    padding-top: 4px!important; \n    padding-right: 4px!important;\n    stroke: rgb(55 65 81);\n    border-width: 0!important;\n    background: transparent;\n    background-color: transparent!important;\n  }\n\n  .simple-commenter-x-button:hover {\n    box-shadow: none\n  }\n\n  /* Input Groups - for label and input */\n  .simple-commenter-input-group {\n    display: flex;\n    flex-direction: column;\n    gap: 4px; /* Smaller gap between label and input */\n  }\n\n  /* Input Labels */\n  .simple-commenter-label {\n    font-size: 14px !important;\n    font-weight: 500 !important;\n    color: rgb(55, 65, 81) !important;\n    line-height: 1.5 !important;\n    text-transform: none !important;\n  }\n\n  .simple-commenter-xs {\n    font-size: 0.725em;\n    font-weight: 300;\n    color: rgb(55, 65, 81);\n    margin-left: 4px;\n  }\n\n  /* Input Fields */\n  .simple-commenter-input {\n    width: 100%;\n    padding: 8px 12px !important;\n    font-size: 14px !important;\n    border: 1px solid #E1E1E1 !important;\n    border-radius: 8px !important;\n    background: #F7F7F7!important;\n    color: #515151 !important;\n    resize: vertical;\n    outline: none;\n    transition: border-color 0.2s ease-in-out !important;\n    font-family: "Poppins", sans-serif !important;\n    line-height: unset;\n    box-shadow: none;\n  }\n\n  .simple-commenter-input::placeholder {\n    color: #9E9E9E !important\n  }\n\n  .simple-commenter-textarea::placeholder {\n    color: #9E9E9E !important\n  }\n\n  .simple-commenter-title-input {\n    color: #3B3B3B !important;\n    min-height: auto !important;\n    font-weight: 500;\n    margin-left: 8px;\n  }\n\n  .simple-commenter-title-input::placeholder {\n    font-weight: 500;\n    color: #9E9E9E !important\n  }\n\n  /* Input Focus State */\n  .simple-commenter-input:focus {\n      border-color: #000!important;\n      --tw-ring-color: #000!important;\n      box-shadow: none;\n  }\n\n  /* Checkbox Container */\n  .simple-commenter-checkbox-container {\n      display: flex;\n      align-items: flex-start;\n      gap: 8px;\n      padding-top: 8px;\n  }\n\n  /* Checkbox */\n  .simple-commenter-checkbox {\n    width: 16px;\n    height: 16px;\n    margin-top: 1px;\n    border: 1px solid rgb(209, 213, 219);\n    border-radius: 4px;\n    appearance: none;\n    cursor: pointer;\n    transition: background 0.2s ease-in-out, border-color 0.2s ease-in-out;\n  }\n\n  /* Checkbox Checked State */\n  .simple-commenter-checkbox:checked {\n      background: rgb(55, 65, 81);\n      border-color: rgb(55, 65, 81);\n  }\n\n  /* Checkbox Label */\n  .simple-commenter-checkbox-label {\n    font-size: 14px; /* text-sm */\n    color: rgb(55, 65, 81);\n    cursor: auto;\n    margin: 0;\n  }\n\n  .simple-commenter-privacy {\n    font-size: 12px;\n    color: #626262 !important\n\n  }\n\n  .simple-commenter-p-0 {\n    padding: 0;\n  }\n\n  .simple-commenter-p-4 {\n    padding: 16px 12px;\n  }\n\n  .simple-commenter-p-fix {\n    padding: 8px 0;\n  }\n\n  .simple-commenter-mr-4 {\n    margin-right: 16px;\n  }\n\n  .simple-commenter-ml-2 {\n    margin-left: 10px;\n  }\n\n  .simple-commenter-m-1-5 {\n    margin: 6px;\n  }\n\n  .simple-commenter-text-sm {\n    font-size: 14px!important; /* Equivalent to Tailwind's text-sm */\n  }\n\n  .simple-commenter-text-xs {\n    font-size: 12px!important; /* Equivalent to Tailwind's text-xs */\n  }\n\n  .simple-commenter-draw-icons-div {\n    margin-left: 8px !important;\n  }\n\n   /* Heading */\n  .simple-commenter-heading {\n    font-size: 16px;       \n    font-weight: 500;      \n    color: #1a202c;        \n    margin-bottom: 0;\n    margin-top: 0;\n  }\n\n    /* Label */\n  .simple-commenter-paragraph {\n    margin-top: 4px;   \n    font-size: 14px;   \n    color: #6b7280;        \n  }\n\n  .simple-commenter-icons {\n    width: 26px;\n    height: 26px;\n    border-radius: 6px;\n    padding: 2px;\n    display: block;\n    background: transparent!important;\n    color: #515151;\n    stroke: #515151;\n    vertical-align: middle; /* Add this */\n  }\n\n  .simple-commenter-icon-button-div {\n    display: flex;\n    align-items: center;\n    cursor: auto;\n  }\n\n  .simple-commenter-login {\n    display: flex;\n  }\n\n  .simple-commenter-logo {\n    width: 48px;\n    height: 48px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 10px;\n    background: white;\n    border-radius: 9999em;\n    border: 1px solid rgb(229 231 235) !important;\n    stroke: transparent!important;\n    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.05)\n  }\n\n  .simple-commenter-logo:hover {\n    background: #F7F7F7!important;\n    stroke: transparent!important;\n  }\n\n\n  .simple-commenter-icons-logo {\n    margin-top: 2px;\n  }\n\n  .simple-commenter-icons-small {\n    width: 20px;\n    height: 20px;\n  }\n\n  .simple-commenter-fill {\n    fill: #9E9E9E;\n    stroke: #9E9E9E;\n  }\n\n  .simple-commenter-btn-unavailable {\n    color: #9E9E9E;\n    stroke: #9E9E9E;\n  }\n\n  \n  .simple-commenter-icons:hover {\n   background: #E1E1E1!important;\n  }\n\n  .simple-commenter-icons-active {\n    background: #E1E1E1!important;\n    border-radius: 6px;\n  }\n\n  .simple-commenter-icons-active:hover {\n    background: #E1E1E1!important;\n    border-radius: 6px;\n  }\n\n  .simple-commenter-check-button:hover {\n    background: transparent !important;\n    stroke: #7BC47F\n  }\n\n  .simple-commenter-check-badge {\n    border: none;\n    stroke: none;\n  }\n\n  .simple-commenter-check-badge:hover {\n    background: transparent !important;\n    cursor: auto;\n  }\n\n  .simple-commenter-display-none {\n    display: none!important\n  }\n\n  .simple-commenter-vertical-line {\n    width: 1px;\n    background-color: #000; /* Default color, adjust as needed */\n    margin: 6px;\n  }\n\n  .simple-commenter-shape {\n    position: absolute;\n    pointer-events: none;\n    z-index: 10000;\n  }\n\n  .simple-commenter-shape:hover {\n    cursor: move; /* Hand cursor for dragging */\n  }\n\n  .simple-commenter-cursor-move:hover {\n    cursor: move; /* Hand cursor for dragging */\n  }\n\n  /* Override move cursor when drawing */\n  .simple-commenter-drawing-in-progress .simple-commenter-shape:hover {\n    cursor: crosshair !important; /* Force crosshair during drawing */\n  }\n\n  .simple-commenter-square {\n    border: 2px solid red;\n    border-radius: 6px;\n  }\n\n  .simple-commenter-circle {\n    border: 2px solid blue;\n    border-radius: 50%;\n  }\n\n  .simple-commenter-line {\n    background-color: green;\n    transform-origin: top left; /* For rotation */\n  }\n\n  .simple-commenter-arrow {\n    background-color: purple;\n    transform-origin: top left; /* For rotation */\n  }\n\n  .simple-commenter-arrow::after {\n    content: '';\n    position: absolute;\n    width: 0;\n    height: 0;\n    border-style: solid;\n    border-width: 6px 0 6px 10px;\n    border-color: transparent transparent transparent purple;\n    top: 50%;\n    left: 100%;\n    transform: translateY(-50%);\n  }\n\n  /* Modify this rule */\n  .simple-commenter-pen {\n    position: absolute;\n    overflow: visible; /* Keep this */\n    pointer-events: none; /* Keep this for the container */\n    z-index: 10000; /* Keep this or adjust */\n    stroke: purple; /* Or theme color */\n  }\n\n  /* Keep path styles */\n  .simple-commenter-pen path {\n    stroke-width: 4px;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    fill: none;\n    pointer-events: auto; /* Path should be interactive */\n  }\n\n  .simple-commenter-color-picker {\n    position: absolute;\n    display: none;\n    background: #F7F7F7;\n    border: 1px solid rgb(229 231 235);\n    padding: 5px;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);\n    z-index: 10001; /* Above shapes, maybe above modebox? */\n    display: flex; /* Use flexbox for layout */\n    gap: 5px; /* Space between color options */\n    transform: translateX(-50%);\n    left: 50%;\n    margin-top: 4px;\n  }\n\n  .simple-commenter-tooltip {\n  position: absolute;\n  left: 50%;\n  bottom: 120%; /* Show above the button */\n  transform: translateX(-50%);\n  background: #F7F7F7;\n  border: 1px solid rgb(229 231 235);\n  padding: 5px 12px;\n  border-radius: 8px;\n  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);\n  z-index: 10001;\n  font-size: 13px;\n  color: #222;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 0.2s cubic-bezier(.4,0,.2,1);\n  white-space: nowrap;\n  user-select: none;\n  /* Optional: fade in from below */\n  transition: opacity 0.2s cubic-bezier(.4,0,.2,1), transform 0.2s cubic-bezier(.4,0,.2,1);\n  transform: translateX(-50%) translateY(8px);\n}\n\n.simple-commenter-tooltip.visible {\n  opacity: 1;\n  pointer-events: auto;\n  transform: translateX(-50%) translateY(0);\n}\n\n\n  .simple-commenter-move-button {\n    display: flex;\n    background: #F7F7F7;\n    height: 36px;\n    border-top-left-radius: 12px;\n  }\n\n  .simple-commenter-move-button:hover {\n    background: #E1E1E1!important;\n  }\n\n  .simple-commenter-flex {\n    display: flex;\n  }\n\n  .simple-commenter-move-btn {\n    cursor: move; /* Hand cursor for dragging */\n    padding: 6px 0;\n  }    \n\n  .simple-commenter-border-top {\n    border-top: 1px solid #F7F7F7;\n  }\n\n  .simple-commenter-gallery-modal {\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%); /* Keep it centered */\n    background: rgba(255, 255, 255, 0.95);\n    padding: 20px;\n    border-radius: 10px;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n    z-index: 90999;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    max-width: 1280px; /* Tailwind max-w-7xl */\n    width: calc(100vw - 2em); /* Full width minus margin */\n    max-height: calc(100vh - 2em); /* Full height minus margin */\n    overflow: auto;\n    animation: fadeIn 0.3s ease-in-out;\n  }\n\n  .simple-commenter-gallery-image {\n    max-width: 100%;\n    max-height: calc(100vh - 64px - 40px); /* Account for padding and close button */\n    border-radius: 5px;\n    object-fit: contain;\n  }\n\n  .simple-commenter-gallery-close {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    background: #ff4444;\n    border: none;\n    border-radius: 50%;\n    width: 30px;\n    height: 30px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    transition: background 0.2s;\n  }\n\n  .simple-commenter-transition {\n    transition: all 150ms ease-in-out;\n  }\n\n  .simple-commenter-gallery-close:hover {\n    background: #cc0000;\n  }\n\n  .simple-commenter-gallery-close svg {\n    width: 20px;\n    height: 20px;\n    stroke: #fff;\n  }\n\n  .simple-commenter-gallery-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 90998;\n  }\n\n  .simple-commenter-screenshot-container {\n    position: relative;\n    display: flex;\n    align-items: center;\n    margin-top: 4px;\n    gap: 8px;\n    border: 1px solid #e0e0e0;\n    border-radius: 8px;\n    background-color: #f9f9f9;\n    cursor: pointer;\n    width: 100%;\n    overflow: hidden;\n    padding: 14px;\n  }\n\n  .simple-commenter-screenshot-container img {\n    position: absolute;\n    top: 0;\n    left: 0;\n    border-radius: 4px;\n    object-fit: cover;\n  }\n\n  .simple-commenter-screenshot-container:hover {\n    background-color: #f0f0f0;\n    border: 1px solid #e0e0e0;\n    box-shadow: none;\n    color: #626262;\n  }\n\n  .simple-commenter-screenshot-text {\n    padding: 6px;\n    flex: 1 1 0% !important;\n    font-size: 14px;\n    font-weight: 500;\n    text-decoration: none;\n    line-height: 0;\n    text-transform: none;\n    color: #222222;\n    font-family: "Poppins", sans-serif !important;\n  }\n\n  .simple-commenter-cursor-override,\n  .simple-commenter-cursor-override * {\n    cursor: url("data:image/svg+xml,%0A%20%20%20%20%20%20%3Csvg%0A%20%20%20%20%20%20%20%20width%3D%2222%22%0A%20%20%20%20%20%20%20%20height%3D%2222%22%0A%20%20%20%20%20%20%20%20viewBox%3D%220%200%2028%2028%22%0A%20%20%20%20%20%20%20%20fill%3D%22none%22%0A%20%20%20%20%20%20%20%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%0A%20%20%20%20%20%20%3E%0A%20%20%20%20%20%20%20%20%3Cpath%0A%20%20%20%20%20%20%20%20%20%20d%3D%22M3.52903%202H14C20.629%202%2026%207.37097%2026%2014C26%2020.629%2020.629%2026%2014%2026C7.37097%2026%202%2020.629%202%2014V3.52903C2%202.6871%202.6871%202%203.52903%202Z%22%0A%20%20%20%20%20%20%20%20%20%20fill%3D%22%23F7D070%22%0A%20%20%20%20%20%20%20%20%20%20stroke%3D%22black%22%0A%20%20%20%20%20%20%20%20%20%20stroke-width%3D%221%22%0A%20%20%20%20%20%20%20%20%20%20class%3D%22simple-commenter-logo-fill%22%0A%20%20%20%20%20%20%20%20%2F%3E%0A%20%20%20%20%20%20%20%20%3Cpath%0A%20%20%20%20%20%20%20%20%20%20d%3D%22M7.51611%2014H20.4839%22%0A%20%20%20%20%20%20%20%20%20%20stroke%3D%22black%22%0A%20%20%20%20%20%20%20%20%20%20stroke-width%3D%221.4%22%0A%20%20%20%20%20%20%20%20%20%20stroke-miterlimit%3D%2210%22%0A%20%20%20%20%20%20%20%20%20%20stroke-linecap%3D%22round%22%0A%20%20%20%20%20%20%20%20%2F%3E%0A%20%20%20%20%20%20%20%20%3Cpath%0A%20%20%20%20%20%20%20%20%20%20d%3D%22M14%208V20.9677%22%0A%20%20%20%20%20%20%20%20%20%20stroke%3D%22black%22%0A%20%20%20%20%20%20%20%20%20%20stroke-width%3D%221.4%22%0A%20%20%20%20%20%20%20%20%20%20stroke-miterlimit%3D%2210%22%0A%20%20%20%20%20%20%20%20%20%20stroke-linecap%3D%22round%22%0A%20%20%20%20%20%20%20%20%2F%3E%0A%20%20%20%20%20%20%3C%2Fsvg%3E%0A%20%20%20%20") 6 6, auto;\n  }\n\n  .simple-commenter-pulse-container {\n    position: fixed;\n    pointer-events: none;\n    z-index: 13000;\n  }\n\n  .simple-commenter-pulse-dot {\n    width: 14px;\n    height: 14px;\n    background: #F7D070!important;\n    border-radius: 50%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    transform: translate(-50%, -50%);\n    box-shadow: 0 0 0 1.5px #000;\n  }\n\n  .simple-commenter-pulse-anim {\n    width: 36px;\n    height: 36px;\n    background: #F7D070!important;\n    opacity: 0.3;\n    border-radius: 50%;\n    position: absolute;\n    left: 0;\n    top: 0;\n    transform: translate(-50%, -50%);\n    animation: simple-commenter-pulse 2s infinite;\n  }\n\n  @keyframes simple-commenter-pulse {\n    0% {\n      transform: translate(-50%, -50%) scale(0.7);\n      opacity: 0.7;\n    }\n    70% {\n      transform: translate(-50%, -50%) scale(1.5);\n      opacity: 0;\n    }\n    100% {\n      transform: translate(-50%, -50%) scale(0.7);\n      opacity: 0;\n    }\n  }\n\n\n\n  /* Fade-in animation */\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n     /* transform: translate(-50%, -50%) scale(0.9);*/\n    }\n    to {\n      opacity: 1;\n    /*  transform: translate(0%, 0%) scale(1);*/\n    }\n  }\n\n  @keyframes fadeOut {\n    from {\n      opacity: 1;\n    }\n    to {\n      opacity: 0;\n    }\n  }\n\n  `;const defaultLocalization=[{key:"post",value:"Post"},{key:"enterCommentTitlePlaceholder",value:"Enter Comment Title.."},{key:"enterCommentPlaceholder",value:"Enter your comment here..."},{key:"addReplyPlaceholder",value:"Add a reply..."},{key:"addReply",value:"Add Reply"},{key:"reply",value:"Reply"},{key:"resolve",value:"Resolve"},{key:"allComments",value:"All Comments"},{key:"thisPage",value:"on this page"},{key:"allPages",value:"on all pages"},{key:"noComments",value:"No comments yet."},{key:"newComment",value:"New Comment"},{key:"viewComment",value:"View Comment"},{key:"viewScreenshot",value:"View Screenshot"},{key:"anonymous",value:"Anonymous"},{key:"client",value:"Client"},{key:"team",value:"Team Member"},{key:"user",value:"Workspace Admin"},{key:"userNameTitle",value:"Whoâ€™s Commenting?"},{key:"userNameDescription",value:"Enter your name and email to attach them to your comment."},{key:"name",value:"Name"},{key:"email",value:"Email"},{key:"namePlaceholder",value:"Enter your name"},{key:"emailPlaceholder",value:"Enter your email"},{key:"userEmailCheckbox",value:"Get notifications when your comments get resolved or replied."},{key:"userSave",value:"Confirm & Comment"},{key:"resetUserData",value:"Reset"},{key:"userNameErrorText",value:"Please enter a name."},{key:"userEmailErrorText",value:"Please enter a valid email address."},{key:"notifications",value:"Notifications"},{key:"enabled",value:"Enabled"},{key:"disabled",value:"Disabled"},{key:"logout",value:"Go Incognito"},{key:"attachIdentity",value:"Identify yourself"},{key:"draw",value:"Annotate by drawing"},{key:"screenshot",value:"Capture a screenshot"},{key:"justNow",value:"just now"},{key:"minAgo",value:"min ago"},{key:"hoursAgo",value:"hours ago"},{key:"daysAgo",value:"days ago"},{key:"weeksAgo",value:"weeks ago"},{key:"monthsAgo",value:"months ago"},{key:"yearsAgo",value:"years ago"},{key:"loginTitle",value:"Login to Simple Commenter"},{key:"loginDescription",value:"To comment, please log in with your email. We will send you a link to access your comments."},{key:"loginButton",value:"Login with Email"},{key:"checkEmail",value:"Please check your inbox and click the link to complete your login.\n\nIf you don't see the email, make sure to check your spam or junk folder."},{key:"loginError",value:"Login Error"},{key:"unauthorized",value:"Account not found. Please login with an authorized email."},{key:"loginErrorButton",value:"Try Again"},{key:"privacy",value:"By logging in, you agree to Simple Commenter [Terms of Service] and [Privacy Policy].",links:[{placeholder:"[Terms of Service]",url:"https://www.simplecommenter.com/terms-conditions",translation:"Terms of Service"},{placeholder:"[Privacy Policy]",url:"https://www.simplecommenter.com/privacy",translation:"Privacy Policy"}]}];const applyCustomTheme=theme=>{const rawSvg=generateCommentArrow(theme.primary);const encodedCursor=encodeURIComponent(rawSvg).replace(/'/g,"%27").replace(/"/g,"%22");const customStyle=`\n      /* Mode Box Styles */\n      .simple-commenter-modebox {\n        background: ${theme.background}!important;\n        border: 1px solid ${theme.border}!important;\n      }\n  \n      /* Button Default Styles */\n      .simple-commenter-modebox > button {\n        background: ${theme.background};\n        color: ${theme.text};\n        stroke: ${theme.text}!important; /* Assuming stroke is based on text color */\n      }\n  \n      /* Active Button Styles */\n      .simple-commenter-active-button,\n      .simple-commenter-view-button,\n      .simple-commenter-disabled-button,\n      .simple-commenter-pulse-dot,\n      .simple-commenter-pulse-anim {\n        background-color: ${theme.primary} !important;\n        color: ${theme.text}!important;\n        border-color: #000 !important;\n      }\n\n      .simple-commenter-active-button:hover {\n        background-color: ${theme.primary}!important;\n        color: ${theme.text}!important;\n        border-color: #000 !important;\n      }\n\n      /* Modebox Border Styles */\n      .simple-commenter-border {\n        border-color: ${theme.border}!important;\n      }\n\n      /* Overlay Styles */\n      .simple-commenter-comment-marker {\n        background: ${theme.primary};\n        stroke: ${theme.border}\n      }\n  \n      /* Overlay Styles */\n      .simple-commenter-overlay {\n        background-color: ${theme.overlay};\n        opacity: 0.4; /* Set opacity */\n      }\n\n      .simple-commenter-background-primary {\n        fill: ${theme.primary};\n      }\n\n      .simple-commenter-logo-fill {\n        fill: ${theme.primary};\n      }\n    \n      .simple-commenter-arrow::after {\n        /* Arrowhead color (specifically the visible border side) */\n        border-color: transparent transparent transparent ${theme.primary};\n      }\n\n      .simple-commenter-arrow-custom::after {\n        /* Arrowhead color (specifically the visible border side) */\n        border-color: transparent transparent transparent var(--theme-color);\n      }\n\n      .simple-commenter-pen {\n        stroke: ${theme.primary};\n      }\n\n      /* Modebox Container Styles */\n      .simple-commenter-modebox-container {\n        ${theme.modalAlign===2?`\n              left: 1.25em;\n              right: auto;\n              align-items: flex-start;\n            `:theme.modalAlign===1?`\n              left: 50%;\n              right: auto;\n              transform: translateX(-50%);\n              align-items: center;\n            `:""}\n      }\n\n      .simple-commenter-cursor-override * {\n        cursor: url("data:image/svg+xml,${encodedCursor}") 6 6, auto !important;\n      }\n    `;const oldStyle=document.getElementById("simple-commenter-theme-style");if(oldStyle){oldStyle.parentNode.removeChild(oldStyle)}const styleEl=document.createElement("style");styleEl.id="simple-commenter-theme-style";styleEl.innerHTML=customStyle;document.head.appendChild(styleEl)};const applyShapeColor=colorValue=>{const styleId="simple-commenter-shape-styles";let styleEl=document.getElementById(styleId);if(!styleEl){styleEl=document.createElement("style");styleEl.id=styleId;document.head.appendChild(styleEl)}const customStyle=`\n      .simple-commenter-background-primary {\n        fill: ${colorValue};\n      }\n    `;styleEl.innerHTML=customStyle};function removeCommenterElements(){const modeBox=document.getElementById("simple-commenter-modebox");if(modeBox){modeBox.remove()}const modeBoxC=document.getElementById("simple-commenter-modebox-container");if(modeBoxC){modeBoxC.remove()}const overlay=document.querySelector(".simple-commenter-overlay");if(overlay){overlay.remove()}document.querySelectorAll(".simple-commenter-comment-marker, .simple-commenter-comment-box, .simple-commenter-container, .simple-commenter-disabled-button").forEach((el=>el.remove()));removeSimpleCommenterStyle();currentElement=null;commentInputUI=null;removePulse();comments=[];active=false}function timeAgo(dateString){const now=new Date;const past=new Date(dateString);const msPerMinute=60*1e3;const msPerHour=msPerMinute*60;const msPerDay=msPerHour*24;const msPerWeek=msPerDay*7;const msPerMonth=msPerDay*30;const msPerYear=msPerDay*365;const elapsed=now-past;if(elapsed<msPerMinute){return localize("justNow")}else if(elapsed<msPerHour){return Math.round(elapsed/msPerMinute)+` ${localize("minAgo")}`}else if(elapsed<msPerDay){return Math.round(elapsed/msPerHour)+` ${localize("hoursAgo")}`}else if(elapsed<msPerWeek){return Math.round(elapsed/msPerDay)+` ${localize("daysAgo")}`}else if(elapsed<msPerMonth){return Math.round(elapsed/msPerWeek)+` ${localize("weeksAgo")}`}else if(elapsed<msPerYear){return Math.round(elapsed/msPerMonth)+` ${localize("monthsAgo")}`}else{return Math.round(elapsed/msPerYear)+` ${localize("yearsAgo")}`}}let currentElement=null;let commentInputUI=null;let commentIdCounter=0;let comments=[];let allComments=[];let mode="disabled";let userMode="user";let theme=[];let localization=[];const defaultUserData={name:"",email:"",userId:null,notify:false,role:"client",mode:"disabled",token:null,spam:false,spamUpdated:null,spamReason:"",checkEmail:false,verified:false,unauthorized:false,login:false,localization:[],theme:[],paramActive:false,associated:true};let simpleCommenterUserData=defaultUserData;let initialLoad=true;let screenshotData=null;let capturing=null;let selectedColorValue=null;let adminBar=false;let paramActiveSetting=false;let pageComments=true;let auth=false;let active=false;let drawing=true;let screenshots=true;let metaData=true;let isMobile=false;let resolveSettings=false;let pageCommentsButton=null;let allCommentsButton=null;let emailFromUrl=null;const scriptEl=document.currentScript;const storedUserData=localStorage.getItem("simpleCommenterUserData");if(storedUserData){try{simpleCommenterUserData=JSON.parse(storedUserData)}catch(error){console.error("Error parsing stored userData:",error)}}const getUserMetadata=async()=>{let metadata={userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,language:navigator.language,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};if(navigator.userAgentData){try{const userAgentData=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion"]);metadata.platform=userAgentData.platform||"Unknown OS";metadata.platformVersion=userAgentData.platformVersion||"Unknown";metadata.model=userAgentData.model||"Unknown";metadata.browserVersion=userAgentData.uaFullVersion||"Unknown"}catch(err){console.warn("Could not retrieve userAgentData:",err)}}else{metadata.platform="Unavailable (deprecated)"}return metadata};const applyLocalization=localization=>{const defaultMap=defaultLocalization.reduce(((map,item)=>{map[item.key]={value:item.value,links:item.links||[]};return map}),{});const customMap=(localization||[]).reduce(((map,item)=>{map[item.key]={value:item.value,links:item.links||[]};return map}),{});return key=>{const entry=customMap[key]||defaultMap[key]||{value:key,links:[]};let result=entry.value;entry.links.forEach((link=>{const placeholder=link.placeholder.replace(/[[\]]/g,"\\$&");const regex=new RegExp(placeholder,"g");result=result.replace(regex,` <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="simple-commenter-comment-meta-button">${link.translation}</a>`)}));return result}};let localize=key=>{const entry=defaultLocalization.find((item=>item.key===key))||{value:key,links:[]};let result=entry.value;entry.links?.forEach((link=>{const placeholder=link.placeholder.replace(/[[\]]/g,"\\$&");const regex=new RegExp(placeholder,"g");result=result.replace(regex,`<a href="${link.url}" target="_blank" rel="noopener noreferrer" class="border-b border-white font-semibold">${link.translation}</a>`)}));return result};function getDomainAndOther(){const url=new URL(scriptEl.src,window.location.href);let domain=scriptEl.getAttribute("data-domain");if(!domain){if(scriptEl){try{domain=url.searchParams.get("domain")}catch(err){console.error("Error parsing the script URL:",err)}}}paramActiveSetting=url.searchParams.get("paramActive")==="true";auth=url.searchParams.get("auth")==="true";return domain}const domain=getDomainAndOther();const endpoint=window?.location?.hostname==="localhost"?"http://localhost:3000/api/js/":"https://www.simplecommenter.com/api/js/";let lastUrl=location.href;setInterval((()=>{const currentUrl=location.href;if(currentUrl!==lastUrl){fetchData();lastUrl=currentUrl}comments.forEach((comment=>{const element=getElementByXPath(comment.elementXPath);if(!element&&!comment.isError){const marker=document.querySelector(`.simple-commenter-comment-marker[data-id="${comment.id}"]`);if(marker)marker.remove();const commentBox=document.querySelector(`.simple-commenter-comment-box[data-id="${comment.id}"]`);if(commentBox)commentBox.remove();comment.isError=true;comment._lastRect=null;updateCommentList();return}if(comment.isError){if(element&&simpleCommenterUserData.mode!=="disabled"){comment.isError=false;updateCommentList();displaySingleComment(comment);return}}if(element&&simpleCommenterUserData.mode!=="disabled"){const rect=element.getBoundingClientRect();const newRect={left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:rect.width,height:rect.height};const lastRect=comment._lastRect;const hasMoved=!lastRect||Math.abs(lastRect.left-newRect.left)>1||Math.abs(lastRect.top-newRect.top)>1||Math.abs(lastRect.right-newRect.right)>1||Math.abs(lastRect.bottom-newRect.bottom)>1;if(hasMoved){displaySingleComment(comment);comment._lastRect=newRect}}}))}),500);const fetchFont=async()=>{const link=document.createElement("link");link.href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap";link.rel="stylesheet";document.head.appendChild(link)};const parseAndNormalize=(urlString,isDomainParam=false)=>{let url;try{if(isDomainParam&&!/^https?:\/\//i.test(urlString)){urlString="http://"+urlString}url=new URL(urlString)}catch(err){console.error(`[Validation Helper] Invalid URL format: ${urlString}`,err);return null}let hostname=url.hostname.replace(/^www\./,"");const port=url.port;if(port&&!["80","443"].includes(port)){hostname+=`:${port}`}let pathname=url.pathname.replace(/\/$/,"");if(pathname===""){pathname="/"}return{hostname:hostname,pathname:pathname}};const validateDomainAndReferrer=(domain,referrer)=>{const domainInfo=parseAndNormalize(domain,true);const referrerInfo=parseAndNormalize(referrer,false);if(!domainInfo||!referrerInfo){console.error("[Validation] Failed to parse domain or referrer URL. Validation failed.");return false}if(domainInfo.hostname!==referrerInfo.hostname){console.warn(`[Validation] Domain mismatch: Configured domain (${domainInfo.hostname}) does not match current page domain (${referrerInfo.hostname}). Validation failed.`);return false}if(domainInfo.pathname!=="/"){const escapedDomainPath=domainInfo.pathname.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");const pathRegex=new RegExp(`(^|/)${escapedDomainPath}(\\/|$)`);if(!pathRegex.test(referrerInfo.pathname)){console.warn(`[Validation] Path mismatch: Current page path (${referrerInfo.pathname}) is not within the configured domain path (${domainInfo.pathname}). Validation failed.`);return false}}else{}return true};function checkSimpleCommenterActive(referrer){const url=new URL(referrer);const isSimpleCommenterActive=url.searchParams.get("simple-commenter")==="true";if(isSimpleCommenterActive){updateUserData({paramActive:true,spam:false,spamUpdated:null})}return simpleCommenterUserData.paramActive||false}function validateEmail(email){const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return typeof email==="string"&&emailRegex.test(email)}function getAndUpdateToken(referrer){try{const url=new URL(referrer);const tokenFromUrl=url.searchParams.get("simple-commenter-token");emailFromUrl=url.searchParams.get("email");if(emailFromUrl&&emailFromUrl.includes(" ")){emailFromUrl=emailFromUrl.replace(/ /g,"+")}if(emailFromUrl&&validateEmail(emailFromUrl)){updateUserData({email:emailFromUrl})}else if(emailFromUrl){console.warn("Invalid email in URL param:",emailFromUrl)}if(tokenFromUrl){if(tokenFromUrl!==simpleCommenterUserData.token){updateUserData({token:tokenFromUrl,spam:false,spamUpdated:null})}return{token:tokenFromUrl,login:true}}if(simpleCommenterUserData.token){return{token:simpleCommenterUserData.token,login:true}}return{token:null,login:false}}catch(error){console.error("Error processing token:",error);return{token:null,login:false}}}function checkSpamStatus({token:token,login:login}){if(simpleCommenterUserData.spam&&simpleCommenterUserData.spamUpdated){const now=Date.now();const spamAge=(now-simpleCommenterUserData.spamUpdated)/1e3;if(spamAge<1800){return true}else{updateUserData({spam:false,spamUpdated:null})}}return false}function updateUserData(newData){console.log("updateUserData called with:",newData);try{const sanitizedNewData=Object.keys(newData).reduce(((acc,key)=>{const value=newData[key];if(value!==null&&value!==undefined){acc[key]=value}return acc}),{});const allowedRoles=["user","client","team"];if(Object.prototype.hasOwnProperty.call(sanitizedNewData,"role")&&allowedRoles.includes(sanitizedNewData.role)){if(!sanitizedNewData.name){sanitizedNewData.name=getDisplayNameIfNoName(sanitizedNewData)}}simpleCommenterUserData={...simpleCommenterUserData,...sanitizedNewData};const allowedFields=["name","email","userId","notify","role","mode","verified","checkEmail","active","login","spam","spamUpdated","spamReason","token","localization","unauthorized","theme","paramActive","associated"];Object.keys(simpleCommenterUserData).forEach((key=>{if(!allowedFields.includes(key)){delete simpleCommenterUserData[key]}}));localStorage.setItem("simpleCommenterUserData",JSON.stringify(simpleCommenterUserData));if(simpleCommenterUserData.checkEmail)refreshUserInner();if(simpleCommenterUserData.unauthorized)refreshUserInner();return simpleCommenterUserData}catch(error){console.error("Failed to update localStorage:",error);return null}}function removeSimpleCommenterStyle(){const styleIds=["simple-commenter-style","simple-commenter-theme-style","simple-commenter-shape-styles"];styleIds.forEach((id=>{const styleEl=document.getElementById(id);if(styleEl){styleEl.parentNode.removeChild(styleEl)}}))}function injectSimpleCommenterStyle(styleString){if(!document.getElementById("simple-commenter-style")){const styleEl=document.createElement("style");styleEl.id="simple-commenter-style";styleEl.innerHTML=styleString;document.head.appendChild(styleEl)}}function checkSimpleCommenterHash(){const hash=window.location.hash;const match=hash.match(/^#simple-comment=([a-zA-Z0-9]+)/);if(match){const commentId=match[1];setTimeout((()=>{const marker=document.querySelector(`.simple-commenter-comment-marker[data-id="${commentId}"]`);marker?.scrollIntoView({behavior:"smooth",block:"center"});const commentBox=document.querySelector(`.simple-commenter-comment-box[data-id="${commentId}"]`);if(commentBox){if(!marker){const element=getElementByXPath(comment.elementXPath,{ignoreVisibility:true});if(element){element.scrollIntoView({behavior:"smooth",block:"center"})}}commentBox.style.visibility="visible";commentBox.style.pointerEvents="auto"}else if(typeof displaySingleComment==="function"){displaySingleComment({id:commentId},true)}}),100)}}const fetchLogin=async()=>{const referrer=document.URL;const{token:token,login:login}=getAndUpdateToken(referrer);const response=await fetch(`${endpoint}login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:domain,type:"pageview",referrer:referrer,token:simpleCommenterUserData.token,userData:simpleCommenterUserData})});const data=await response.json();const userData=data.userData;if(response.ok){if(userData){updateUserData({...data.userData})}if(userData.unauthorized){updateUserData({unauthorized:true,spamMessage:userData.spamMessage})}if(userData.active){fetchData();changeMode("view")}}};const fetchData=async()=>{const referrer=document.URL;const url=new URL(referrer);const savedUserData=localStorage.getItem("simpleCommenterUserData");updateUserData(savedUserData);if(initialLoad){try{injectSimpleCommenterStyle(style);adminBar=hasAdminBar()}catch(e){console.error("Failed to append style:",e)}}if(simpleCommenterUserData.theme){applyCustomTheme(simpleCommenterUserData.theme)}if(simpleCommenterUserData.localization){localize=applyLocalization(simpleCommenterUserData.localization)}checkSimpleCommenterActive(referrer);const{token:token,login:login}=getAndUpdateToken(referrer);if(checkSpamStatus({token:token,login:login})){if(simpleCommenterUserData.login){if(!document.getElementById("simple-commenter-modebox")){createClientModeSelector()}}else{removeCommenterElements()}return}const isDomainValid=validateDomainAndReferrer(domain,referrer);if(!isDomainValid){console.error(`Validation failed: Domain "${domain}" does not match current page "${referrer}".`);removeCommenterElements();return}if(initialLoad){try{injectSimpleCommenterStyle(style);adminBar=hasAdminBar()}catch(e){console.error("Failed to append style:",e)}}const response=await fetch(`${endpoint}getcomments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:domain,type:"pageview",referrer:referrer,paramActive:simpleCommenterUserData.paramActive,token:simpleCommenterUserData.token,userData:simpleCommenterUserData})});const data=await response.json();active=data.active;userMode=data.mode;theme=data.theme;localization=data.localization;drawing=data.drawing;screenshots=data.screenshots;metaData=data.metaData;resolveSettings=data.resolveSettings;allComments=data.allComments||[];const userData=data.userData;if(response.ok){if(window.simpleCommenterDisabled===true){removeCommenterElements();return}if(data.theme){applyCustomTheme(theme);updateUserData({theme:data.theme,associated:data.associated})}localize=applyLocalization(localization);if(data.active===false){if(data.alert){console.error(data.message)}if(data.spam){if(data.spam){updateUserData({spam:data.spam,spamUpdated:Date.now(),spamReason:data.message,login:data.login,localization:data.localization,theme:data.theme})}if(data.paramActiveSetting){paramActiveSetting=true;updateUserData({spam:data.spam,spamUpdated:Date.now(),spamReason:"Simple Commenter active parameter from URL missing"})}if(data.login){const oldUserData=simpleCommenterUserData;simpleCommenterUserData=defaultUserData;localStorage.removeItem("simpleCommenterUserData");updateUserData({login:true,paramActive:oldUserData.paramActive,spam:oldUserData.spam,spamUpdated:oldUserData.spamUpdated,theme:oldUserData.theme,localization:oldUserData.localization});if(!document.getElementById("simple-commenter-modebox")&&(paramActiveSetting===false||paramActiveSetting===true&&simpleCommenterUserData.paramActive===true)){createClientModeSelector();showHideLoginContainer(true)}}}removeCommenterElements();return}if(initialLoad){await fetchFont();isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);initialLoad=false;if(emailFromUrl){fetchLogin()}}if(userData){updateUserData({...userData,login:false})}comments=data.comments;if(!document.getElementById("simple-commenter-modebox")){createClientModeSelector()}active=true;const storedUserData=localStorage.getItem("simpleCommenterUserData");if(storedUserData){try{simpleCommenterUserData=JSON.parse(storedUserData);refreshUserInner()}catch(error){console.error("Error parsing stored userData:",error)}}updateCommentCount();updateCommentList();changeMode(simpleCommenterUserData.mode);checkSimpleCommenterHash();if(mode==="active"||mode==="view"){await displayComments()}return data}console.warn(data.message)};const modeBox=document.createElement("div");const modeBoxContainer=document.createElement("div");const buttonsContainer=document.createElement("div");const commentListButton=document.createElement("button");const commentListContainer=document.createElement("div");const commentsWrapper=document.createElement("div");const userButton=document.createElement("button");const userContainer=document.createElement("div");const disabledBtn=document.createElement("button");const viewBtn=document.createElement("button");const activeBtn=document.createElement("button");let scButton=null;const createClientModeSelector=async()=>{buttonsContainer.className="simple-commenter-buttons-container";commentListButton.id="simple-commenter-comment-list-button";commentListButton.className="simple-commenter-comment-list-button";commentListContainer.id="simple-commenter-comment-list-container";commentListContainer.className="simple-commenter-comment-list simple-commenter-p-0";commentListContainer.style.display="none";commentListContainer.innerHTML=`<p\n      class="simple-commenter-comment-container simple-commenter-border-0 simple-commenter-heading"\n    >\n      ${localize("allComments")}\n    </p>`;userButton.id="simple-commenter-user-button";userButton.className="simple-commenter-comment-list-button simple-commenter-user-button";userContainer.id="simple-commenter-userContainer";userContainer.className="simple-commenter-comment-list simple-commenter-p-0 simple-commenter-container-smaller";userContainer.style.display="none";const xButton=document.createElement("button");xButton.className="simple-commenter-close-button";xButton.setAttribute("aria-label","Close comment list");const xUserButton=document.createElement("button");xUserButton.className="simple-commenter-close-button";xUserButton.setAttribute("aria-label","Close comment list");const xSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");xSvg.setAttribute("fill","none");xSvg.setAttribute("viewBox","0 0 24 24");xSvg.setAttribute("strokeLinecap","1.5");xSvg.style.width="20px";xSvg.style.height="20px";xSvg.innerHTML=`<path\n      strokeLinecap="round"\n      strokeLinejoin="round"\n      d="M6 18 18 6M6 6l12 12"\n    />`;xButton.appendChild(xSvg);xUserButton.appendChild(xSvg.cloneNode(true));xButton.onclick=()=>{commentListContainer.style.display="none";commentListButton.classList.remove("simple-commenter-active-button")};xUserButton.onclick=()=>{userContainer.style.display="none";userButton.classList.remove("simple-commenter-active-button")};commentsWrapper.className="simple-commenter-comments-wrapper";commentListContainer.appendChild(xButton);commentListContainer.appendChild(commentsWrapper);const buttonContainer=document.createElement("div");buttonContainer.className="simple-commenter-list-buttons";const allCount=(allComments||[]).length;const pageCount=(comments||[]).length;allCommentsButton=createButton({text:`${allCount} ${localize("allPages")}`,ariaLabel:"Show all comments",className:"simple-commenter-text-sm",onClick:e=>{e.stopPropagation();pageComments=false;updateCommentList();allCommentsButton.classList.add("simple-commenter-active-button");pageCommentsButton.classList.remove("simple-commenter-active-button")}});pageCommentsButton=createButton({text:`${pageCount} ${localize("thisPage")}`,ariaLabel:"Show comments on this page",className:"simple-commenter-text-sm",onClick:e=>{e.stopPropagation();pageComments=true;updateCommentList();pageCommentsButton.classList.add("simple-commenter-active-button");allCommentsButton.classList.remove("simple-commenter-active-button")}});pageCommentsButton.classList.add("simple-commenter-active-button");buttonContainer.appendChild(allCommentsButton);buttonContainer.appendChild(pageCommentsButton);commentListContainer.appendChild(buttonContainer);userContainer.appendChild(xUserButton);const eyeSlashSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");eyeSlashSvg.setAttribute("fill","none");eyeSlashSvg.setAttribute("viewBox","0 0 24 24");eyeSlashSvg.setAttribute("strokeLinecap","1.5");eyeSlashSvg.style.width="24px";eyeSlashSvg.style.height="24px";eyeSlashSvg.style.display="block";eyeSlashSvg.innerHTML=`<path\n      strokeLinecap="round"\n      strokeLinejoin="round"\n      d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"\n    /> `;const eyeSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");eyeSvg.setAttribute("fill","none");eyeSvg.setAttribute("viewBox","0 0 24 24");eyeSvg.setAttribute("strokeLinecap","1.5");eyeSvg.style.width="24px";eyeSvg.style.height="24px";eyeSvg.style.display="block";eyeSvg.innerHTML=`<path\n        strokeLinecap="round"\n        strokeLinejoin="round"\n        d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"\n      />\n      <path\n        strokeLinecap="round"\n        strokeLinejoin="round"\n        d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"\n      />`;const commentSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");commentSvg.setAttribute("fill","none");commentSvg.setAttribute("viewBox","0 0 24 24");commentSvg.setAttribute("strokeLinecap","1.5");commentSvg.style.width="24px";commentSvg.style.height="24px";commentSvg.style.display="block";commentSvg.innerHTML=`<path\n        fillRule="evenodd"\n        d="M4.848 2.771A49.144 49.144 0 0 1 12 2.25c2.43 0 4.817.178 7.152.52 1.978.292 3.348 2.024 3.348 3.97v6.02c0 1.946-1.37 3.678-3.348 3.97-1.94.284-3.916.455-5.922.505a.39.39 0 0 0-.266.112L8.78 21.53A.75.75 0 0 1 7.5 21v-3.955a48.842 48.842 0 0 1-2.652-.316c-1.978-.29-3.348-2.024-3.348-3.97V6.741c0-1.946 1.37-3.68 3.348-3.97Z"\n        clipRule="evenodd"\n      />\n      <line\n        x1="7.5"\n        y1="9.5"\n        x2="15.5"\n        y2="9.5"\n        stroke="black"\n        strokeLinecap="round"\n      />\n      <line\n        x1="11.5"\n        y1="5.5"\n        x2="11.5"\n        y2="13.5"\n        stroke="black"\n        strokeLinecap="round"\n      /> `;modeBox.id="simple-commenter-modebox";modeBox.className="simple-commenter-modebox";disabledBtn.id="simple-commenter-disabled";disabledBtn.setAttribute("aria-label","Disabled");disabledBtn.innerHTML="";disabledBtn.appendChild(eyeSlashSvg);modeBox.appendChild(disabledBtn);viewBtn.id="simple-commenter-view";viewBtn.className="simple-commenter-border";viewBtn.setAttribute("aria-label","View");viewBtn.innerHTML="";viewBtn.appendChild(eyeSvg);modeBox.appendChild(viewBtn);activeBtn.id="simple-commenter-active";activeBtn.className="simple-commenter-border";activeBtn.setAttribute("aria-label","Active");activeBtn.innerHTML="";activeBtn.appendChild(commentSvg);modeBox.appendChild(activeBtn);modeBoxContainer.id="simple-commenter-modebox-container";modeBoxContainer.className="simple-commenter-modebox-container";buttonsContainer.appendChild(userButton);buttonsContainer.appendChild(commentListButton);modeBoxContainer.appendChild(commentListContainer);modeBoxContainer.appendChild(userContainer);modeBoxContainer.appendChild(buttonsContainer);modeBoxContainer.appendChild(modeBox);if(!simpleCommenterUserData.associated){userButton.style.display="none"}scButton=createSCLoginButton();modeBoxContainer.appendChild(scButton);document.body.appendChild(modeBoxContainer);updateCommentCount();updateCommentList();createUserButtonIcon();createUserInner();changeMode(simpleCommenterUserData.mode);disabledBtn.addEventListener("click",(function(){changeMode("disabled")}));viewBtn.addEventListener("click",(function(){changeMode("view")}));activeBtn.addEventListener("click",(function(){changeMode("active")}));commentListButton.addEventListener("click",(e=>{e.stopPropagation();if(commentListContainer.style.display==="none"||commentListContainer.style.display===""){commentListContainer.style.display="block";commentListButton.classList.add("simple-commenter-active-button")}else{commentListContainer.style.display="none";commentListButton.classList.remove("simple-commenter-active-button")}}));userButton.addEventListener("click",(e=>{e.stopPropagation();if(userContainer.style.display==="none"||userContainer.style.display===""){userContainer.style.display="block";userButton.classList.add("simple-commenter-active-button")}else{userContainer.style.display="none";userButton.classList.remove("simple-commenter-active-button")}}))};function createUserButtonIcon(){const userSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");userSvg.setAttribute("fill","none");userSvg.setAttribute("viewBox","0 0 24 24");userSvg.setAttribute("strokeLinecap","1.5");userSvg.style.width="16px";userSvg.style.height="16px";userSvg.style.strokeWidth="1.5";userSvg.innerHTML=` <path\n      stroke-linecap="round"\n      stroke-linejoin="round"\n      d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"\n    />`;userButton.innerHTML="";userButton.appendChild(userSvg)}function createUserInner(){const userContainer=document.getElementById("simple-commenter-userContainer");const loginContainer=loginInner();const logoutContainer=logoutInner();if(simpleCommenterUserData.name||simpleCommenterUserData.email){loginContainer.style.display="none";logoutContainer.style.display="block"}else{loginContainer.style.display="block";logoutContainer.style.display="none"}userContainer.appendChild(loginContainer);userContainer.appendChild(logoutContainer)}function hideMinimizedButton(){const loginContainer=document.getElementById("simple-commenter-login");if(loginContainer.style.display==="flex"){loginContainer.style.display="none"}}function toggleLoginContainer(){const userContainer=document.getElementById("simple-commenter-userContainer");if(userContainer.style.display==="none"||userContainer.style.display===""){userContainer.style.display="block";userButton.classList.add("simple-commenter-active-button")}else{userContainer.style.display="none";userButton.classList.remove("simple-commenter-active-button")}}function showHideLoginContainer(login=false){const loginContainer=document.getElementById("simple-commenter-login");const modeBoxContainer=document.getElementById("simple-commenter-modebox");const userContainer=document.getElementById("simple-commenter-user-button");const commentList=document.getElementById("simple-commenter-comment-list-button");if(!loginContainer||!modeBoxContainer||!userContainer||!commentList){console.error("One or more container elements not found");return}if(login){loginContainer.style.display="flex";modeBoxContainer.style.display="none";userContainer.style.display="none";commentList.style.display="none"}else{const modeBoxDisplay=window.getComputedStyle(modeBoxContainer).display;if(modeBoxDisplay==="block"){loginContainer.style.display="flex";modeBoxContainer.style.display="none";userContainer.style.display="none";commentList.style.display="none"}else{loginContainer.style.display="none";modeBoxContainer.style.display="block";userContainer.style.display="block";commentList.style.display="flex"}}}function createSCLoginButton(){const loginContainer=document.createElement("div");loginContainer.id="simple-commenter-login";loginContainer.className="simple-commenter-login";const simpleCommenterButton=createIconButton({icon:"simpleCommenter",ariaLabel:"Simple Commenter Open",className:"simple-commenter-check-button",onClick:()=>{}});loginContainer.appendChild(simpleCommenterButton);loginContainer.style.display="none";loginContainer.addEventListener("click",(e=>{if(!simpleCommenterUserData.login){changeMode("view");showHideLoginContainer(false)}else{toggleLoginContainer()}}));return loginContainer}function loginInner(){const formContainer=document.createElement("div");formContainer.id="simple-commenter-login-container";formContainer.className="simple-commenter-comment-container simple-commenter-p-0";formContainer.style.zIndex="1112";const headingContainer=document.createElement("div");headingContainer.className="simple-commenter-comment-container simple-commenter-gap-0";headingContainer.innerHTML=`\n      <p class="simple-commenter-heading">\n        ${simpleCommenterUserData.login?localize("loginTitle"):localize("userNameTitle")}\n      </p>\n      <p class="simple-commenter-checkbox-label">\n        ${simpleCommenterUserData.login?localize("loginDescription"):localize("userNameDescription")}\n      </p>\n    `;const inputContainer=document.createElement("div");inputContainer.className="simple-commenter-comment-container";const nameContainer=document.createElement("div");nameContainer.classList.add("simple-commenter-input-group");const nameLabel=document.createElement("label");nameLabel.textContent=localize("name");nameLabel.classList.add("simple-commenter-label");const nameInput=document.createElement("input");nameInput.setAttribute("type","text");nameInput.setAttribute("placeholder",localize("namePlaceholder"));nameInput.classList.add("simple-commenter-input");nameInput.name="firstname";nameInput.autocomplete="given-name";nameContainer.appendChild(nameLabel);nameContainer.appendChild(nameInput);const emailContainer=document.createElement("div");emailContainer.classList.add("simple-commenter-input-group");emailContainer.style.paddingTop="8px";const emailLabel=document.createElement("label");emailLabel.textContent=localize("email");emailLabel.classList.add("simple-commenter-label");const emailInput=document.createElement("input");emailInput.setAttribute("type","email");emailInput.setAttribute("placeholder",localize("emailPlaceholder"));emailInput.name="email";emailInput.autocomplete="email";emailInput.classList.add("simple-commenter-input");emailContainer.appendChild(emailLabel);emailContainer.appendChild(emailInput);const checkboxContainer=document.createElement("div");checkboxContainer.classList.add("simple-commenter-checkbox-container");const notificationCheckbox=document.createElement("input");notificationCheckbox.setAttribute("type","checkbox");notificationCheckbox.id="notify-comments";notificationCheckbox.classList.add("simple-commenter-checkbox");const checkboxLabel=document.createElement("label");checkboxLabel.setAttribute("for","notify-comments");checkboxLabel.textContent=localize("userEmailCheckbox");checkboxLabel.classList.add("simple-commenter-checkbox-label");checkboxContainer.appendChild(notificationCheckbox);checkboxContainer.appendChild(checkboxLabel);const buttonBox=document.createElement("div");buttonBox.className="simple-commenter-comment-box-menu";const associateButton=document.createElement("button");associateButton.textContent=localize("userSave");associateButton.classList.add("simple-commenter-button-green");const nameError=document.createElement("span");nameError.style.color="#D64545";nameError.style.fontSize="0.8rem";nameError.style.display="none";nameContainer.appendChild(nameError);const emailError=document.createElement("span");emailError.style.color="red";emailError.style.fontSize="14px";emailError.style.display="none";emailContainer.appendChild(emailError);const privacyHTML=document.createElement("div");privacyHTML.innerHTML=`<p\n      class="simple-commenter-checkbox-label simple-commenter-privacy"\n    >\n      ${localize("privacy")}\n    </p>`;associateButton.addEventListener("click",(()=>{nameError.style.display="none";emailError.style.display="none";if(emailInput.value.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value.trim())){emailError.textContent=localize("userEmailErrorText");emailError.style.display="block";return}updateUserData({name:nameInput.value.trim(),email:emailInput.value.trim(),notify:notificationCheckbox.checked});fetchLogin();refreshUserInner();userContainer.style.display="none";userButton.classList.remove("simple-commenter-active-button")}));const emptyDiv=document.createElement("div");const resetButton=createButton({text:localize("resetUserData"),onClick:()=>{resetUserData()}});buttonBox.appendChild(resetButton);buttonBox.appendChild(associateButton);buttonBox.style.justifyContent="end";if(!simpleCommenterUserData.login){inputContainer.appendChild(nameContainer)}inputContainer.appendChild(emailContainer);inputContainer.appendChild(privacyHTML);formContainer.appendChild(headingContainer);formContainer.appendChild(inputContainer);formContainer.appendChild(buttonBox);return formContainer}function getDisplayName(user){const roleLabels={user:localize("user"),team:localize("team"),client:localize("client")};const roleLabel=roleLabels[user.role]||"User";if(typeof user.name==="string"&&user.name.trim()!==""){return`${user.name.trim()} - ${roleLabel}`}return roleLabel}function getDisplayNameIfNoName(user){if(typeof user.name==="string"&&user.name.trim()!==""){return user.name.trim()}const roleLabels={user:localize("user"),team:localize("team"),client:localize("client")};const roleLabel=roleLabels[user.role]||roleLabels["client"];return roleLabel}function logoutInner(){const logoutContainer=document.createElement("div");logoutContainer.id="simple-commenter-logout-container";logoutContainer.className="simple-commenter-comment-container simple-commenter-p-0";const headingContainer=document.createElement("div");headingContainer.className="simple-commenter-comment-container simple-commenter-gap-0";headingContainer.innerHTML=`\n      <p class="simple-commenter-heading">\n        ${simpleCommenterUserData.unauthorized?localize("loginError"):localize("userNameTitle")}\n      </p>\n    `;const inputContainer=document.createElement("div");inputContainer.className="simple-commenter-comment-container";const userDataDisplay=document.createElement("div");userDataDisplay.classList.add("simple-commenter-input-group");userDataDisplay.classList.add("simple-commenter-input-group");if(simpleCommenterUserData.verified){const verifiedIcon=createIcon({icon:"check",text:"Verified",color:"#7BC47F"});const p=document.createElement("p");p.className="simple-commenter-checkbox-label";p.appendChild(verifiedIcon);const displayName=getDisplayName(simpleCommenterUserData);p.appendChild(document.createTextNode(" "+displayName));userDataDisplay.appendChild(p)}else{const unverifiedIcon=createIcon({icon:"unverified",text:"Unverified",color:"#9E9E9E"});const p=document.createElement("p");p.className="simple-commenter-checkbox-label";p.appendChild(unverifiedIcon);const displayName=getDisplayName(simpleCommenterUserData);p.appendChild(document.createTextNode(" "+displayName));userDataDisplay.appendChild(p)}if(simpleCommenterUserData.checkEmail){const htmlContent=`<p\n        class="simple-commenter-checkbox-label"\n      >\n        ${localize("checkEmail")}\n      </p>`;userDataDisplay.innerHTML=htmlContent}if(simpleCommenterUserData.unauthorized){const htmlContent=`<p\n        class="simple-commenter-checkbox-label"\n      >\n        ${localize("unauthorized")}\n      </p>`;userDataDisplay.innerHTML=htmlContent}inputContainer.appendChild(userDataDisplay);const buttonBox=document.createElement("div");buttonBox.className="simple-commenter-comment-box-menu";const logoutButton=document.createElement("button");logoutButton.textContent=simpleCommenterUserData.unauthorized?localize("loginErrorButton"):localize("logout");logoutButton.classList.add("simple-commenter-button-green");logoutButton.addEventListener("click",(()=>{const oldUserData=simpleCommenterUserData;simpleCommenterUserData=defaultUserData;localStorage.removeItem("simpleCommenterUserData");updateUserData({login:oldUserData.login,paramActive:oldUserData.paramActive,theme:oldUserData.theme,localization:oldUserData.localization,spam:oldUserData.spam,spamUpdated:oldUserData.spamUpdated});changeMode("disabled");fetchData();refreshUserInner()}));const emptyDiv=document.createElement("div");buttonBox.appendChild(emptyDiv);buttonBox.appendChild(logoutButton);logoutContainer.appendChild(headingContainer);logoutContainer.appendChild(inputContainer);logoutContainer.appendChild(buttonBox);return logoutContainer}function resetUserData(){const oldUserData=simpleCommenterUserData;simpleCommenterUserData=defaultUserData;localStorage.removeItem("simpleCommenterUserData");updateUserData({login:oldUserData.login,paramActive:oldUserData.paramActive,theme:oldUserData.theme,localization:oldUserData.localization});changeMode("disabled");fetchData();refreshUserInner()}function switchToLogout(){document.getElementById("simple-commenter-login-container").style.display="none";document.getElementById("simple-commenter-logout-container").style.display="block"}function switchToLogin(){document.getElementById("simple-commenter-login-container").style.display="block";document.getElementById("simple-commenter-logout-container").style.display="none"}function refreshUserInner(){const oldLogout=document.getElementById("simple-commenter-logout-container");if(oldLogout&&oldLogout.parentNode){oldLogout.parentNode.removeChild(oldLogout)}const oldLogin=document.getElementById("simple-commenter-login-container");if(oldLogin&&oldLogin.parentNode){oldLogin.parentNode.removeChild(oldLogin)}const newLogin=loginInner();const newLogout=logoutInner();const userContainer=document.getElementById("simple-commenter-userContainer");if(userContainer){userContainer.appendChild(newLogin);userContainer.appendChild(newLogout);if(simpleCommenterUserData.checkEmail||simpleCommenterUserData.unauthorized){userContainer.style.display="block";switchToLogout()}else if(simpleCommenterUserData.email&&simpleCommenterUserData.email!==""){switchToLogout()}else{switchToLogin()}}}const updateCommentCount=()=>{const commentCount=(comments||[]).length;const allCommentsCount=(allComments||[]).length;pageCommentsButton.textContent=`${commentCount} ${localize("thisPage")}`;allCommentsButton.textContent=`${allCommentsCount} ${localize("allPages")}`;commentListButton.innerHTML=`\n      <p class="simple-commenter-comment-count">\n        ${commentCount>0?`${commentCount}`:`0`}\n      </p>\n    `;const commentBubbleSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");commentBubbleSvg.setAttribute("fill","none");commentBubbleSvg.setAttribute("viewBox","0 0 24 24");commentBubbleSvg.setAttribute("strokeLinecap","1.5");commentBubbleSvg.style.width="20px";commentBubbleSvg.style.height="20px";commentBubbleSvg.innerHTML=`<path\n      stroke-linecap="round"\n      stroke-linejoin="round"\n      d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"\n    />`;commentListButton.appendChild(commentBubbleSvg)};const updateCommentList=()=>{commentsWrapper.innerHTML="";const fragment=document.createDocumentFragment();if(pageComments){pageCommentsButton.classList.add("simple-commenter-active-button");allCommentsButton.classList.remove("simple-commenter-active-button");if(comments.length===0){const noComments=document.createElement("p");noComments.className="simple-commenter-no-comments";noComments.textContent=localize("noComments");fragment.appendChild(noComments)}else{const sortedComments=comments.slice().sort(((a,b)=>new Date(b.date)-new Date(a.date)));sortedComments.forEach((comment=>{const commentItem=createCommentItem(comment);fragment.appendChild(commentItem)}))}}else{if(allComments.length===0){const noComments=document.createElement("p");noComments.className="simple-commenter-no-comments";noComments.textContent=localize("noComments");fragment.appendChild(noComments)}else{const sortedComments=allComments.slice().sort(((a,b)=>new Date(b.date)-new Date(a.date)));sortedComments.forEach((comment=>{const commentItem=createCommentItem(comment,true,true,false);fragment.appendChild(commentItem)}))}}commentsWrapper.appendChild(fragment)};function deviceMetaData(metadata){const ua=metadata?.userAgent||"";let platform="Unknown";let browser="Unknown";let viewportWidth=metadata?.viewportWidth||window.innerWidth;if(/iPhone|iPad|iPod/.test(ua)){platform="iOS"}else if(/Macintosh/.test(ua)){platform="macOS"}else if(/Windows/.test(ua)){platform="Windows"}else if(/Android/.test(ua)){platform="Android"}else if(/Linux/.test(ua)){platform="Linux"}if(/CriOS\/([\d\.]+)/.test(ua)){browser="Chrome"}else if(/Chrome\/([\d\.]+)/.test(ua)){browser="Chrome"}else if(/FxiOS\/([\d\.]+)/.test(ua)){browser="Firefox"}else if(/Firefox\/([\d\.]+)/.test(ua)){browser="Firefox"}else if(/Version\/([\d\.]+).*Safari/.test(ua)){browser="Safari"}return{platform:platform,browser:browser,viewportWidth:viewportWidth}}const createCommentItem=(comment,asLink=true,externalPage=false,resolve=true)=>{const userData=comment.userData||{};const name=userData.name&&userData.name.trim()?userData.name.trim():userData.role&&["client","team","user"].includes(userData.role)&&localize(userData.role)&&localize(userData.role).trim()?localize(userData.role):localize("anonymous");const formattedDate=timeAgo(comment.date);const commentItem=document.createElement(asLink?"div":"div");commentItem.className=asLink?"simple-commenter-comment-item":"simple-commenter-comment";const header=document.createElement("div");header.className="simple-commenter-comment-header";const nameSpan=document.createElement("span");nameSpan.className="simple-commenter-comment-meta";nameSpan.textContent=name;const dateSmall=document.createElement("small");dateSmall.className="simple-commenter-comment-date";if(asLink){dateSmall.textContent=formattedDate}if(simpleCommenterUserData.associated){header.appendChild(nameSpan)}header.appendChild(dateSmall);const textP=document.createElement("p");textP.className="simple-commenter-title simple-commenter-title-bold";textP.innerHTML=comment.title;textP.style.whiteSpace="pre-wrap";const textarea=document.createElement("p");textarea.className="simple-commenter-title";textarea.innerHTML=comment.text||"";textarea.style.whiteSpace="pre-wrap";if(comment.title.trim()===""){textarea.classList.add("simple-commenter-title-bold")}else{textarea.classList.add("simple-commenter-text")}const{platform:platform,browser:browser,viewportWidth:viewportWidth}=deviceMetaData(comment.metadata);const metaContainer=document.createElement("div");metaContainer.className="simple-commenter-space-between simple-commenter-comment-meta-container";const metaLeft=document.createElement("div");metaLeft.className="simple-commenter-comment-meta-container simple-commenter-login";const metaRight=document.createElement("div");metaRight.className="simple-commenter-gap-1 simple-commenter-align-center";const metaParts=[];if(platform)metaParts.push(platform);if(browser)metaParts.push(browser);if(viewportWidth)metaParts.push(`${viewportWidth} px`);if(comment.replies&&comment.replies.length>0){metaParts.push(`<strong>${comment.replies.length}</strong> ${comment.replies.length===1?"reply":"replies"}`)}let eyeSlashSvg=null;if(comment.isError){eyeSlashSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");eyeSlashSvg.setAttribute("fill","none");eyeSlashSvg.setAttribute("viewBox","0 0 24 24");eyeSlashSvg.setAttribute("stroke-linecap","round");eyeSlashSvg.style.width="16px";eyeSlashSvg.style.height="16px";eyeSlashSvg.style.display="block";const path=document.createElementNS("http://www.w3.org/2000/svg","path");path.setAttribute("stroke-linecap","round");path.setAttribute("stroke-linejoin","round");path.setAttribute("d","M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88");eyeSlashSvg.appendChild(path);const hiddenSpan=document.createElement("span");hiddenSpan.className="simple-commenter-comment-meta simple-commenter-comment-meta-container";hiddenSpan.appendChild(eyeSlashSvg);hiddenSpan.insertAdjacentText("beforeend","Â· ");metaLeft.appendChild(hiddenSpan)}const metaSmall=document.createElement("small");metaSmall.className="simple-commenter-comment-date";metaSmall.innerHTML=metaParts.join(" Â· ");if(metaData){metaLeft.appendChild(metaSmall)}const deleteButton=createButton({text:localize("resolve"),ariaLabel:"Resolve Comment",className:"simple-commenter-text-sm",dataId:comment.id,condition:resolveSettings||!resolve,onClick:e=>{e.stopPropagation();deleteComment(comment.id)}});let viewButton=null;let photoButton=null;if(asLink){viewButton=createButton({text:localize("viewComment"),ariaLabel:"View Comment",className:"simple-commenter-text-sm",onClick:e=>{e.stopPropagation();changeMode("view");if(externalPage){window.location.href=`${comment.slug}#simple-comment=${comment.id}`;return}const marker=document.querySelector(`.simple-commenter-comment-marker[data-id="${comment.id}"]`);marker?.scrollIntoView({behavior:"smooth",block:"center"});const commentBox=document.querySelector(`.simple-commenter-comment-box[data-id="${comment.id}"]`);if(commentBox){if(!marker){const element=getElementByXPath(comment.elementXPath,{ignoreVisibility:true});if(element){element.scrollIntoView({behavior:"smooth",block:"center"})}}commentBox.style.visibility="visible";commentBox.style.pointerEvents="auto"}else{displaySingleComment(comment,keepOpen=true)}}});if(comment.screenshot&&comment.screenshot.imgSmall){photoButton=createIconButton({icon:"photo",ariaLabel:"View Screenshot",className:"simple-commenter-check-button",dataId:comment.id,onClick:e=>{e.stopPropagation();changeMode("view");const marker=document.querySelector(`.simple-commenter-comment-marker[data-id="${comment.id}"]`);marker?.scrollIntoView({behavior:"smooth",block:"center"});const commentBox=document.querySelector(`.simple-commenter-comment-box[data-id="${comment.id}"]`);if(commentBox){if(!marker){const element=getElementByXPath(comment.elementXPath,{ignoreVisibility:true});if(element){element.scrollIntoView({behavior:"smooth",block:"center"})}}commentBox.style.visibility="visible";commentBox.style.pointerEvents="auto"}}})}}if(photoButton){metaRight.appendChild(photoButton)}if(viewButton){metaRight.appendChild(deleteButton);metaRight.appendChild(viewButton)}metaContainer.appendChild(metaLeft);metaContainer.appendChild(metaRight);commentItem.appendChild(header);commentItem.appendChild(textP);commentItem.appendChild(textarea);if(metaParts.length>0||comment.isError){commentItem.appendChild(metaContainer)}if(!asLink&&comment.screenshot&&comment.screenshot.imgSmall){const screenshotButton=createScreenshotButton({screenshot:comment.screenshot});if(screenshotButton){commentItem.appendChild(screenshotButton)}}if(!asLink&&comment.replies&&comment.replies.length>0){const repliesWrapper=document.createElement("div");repliesWrapper.className="simple-commenter-replies-wrapper";comment.replies.forEach((reply=>{const replyItem=createReplyItem(reply);repliesWrapper.appendChild(replyItem)}));commentItem.appendChild(repliesWrapper)}return commentItem};const createReplyItem=reply=>{const userData=reply.userData||{};const name=userData.name&&userData.name.trim()?userData.name:localize("anonymous");const formattedDate=timeAgo(reply.date);const headerHTML=`\n      <div class="simple-commenter-comment-header">\n        <span class="simple-commenter-comment-meta">${name}</span>\n        <small class="simple-commenter-comment-date">${formattedDate}</small>\n      </div>\n    `;if(reply.metadata){const meta=deviceMetaData(reply.metadata);platform=meta.platform;browser=meta.browser;viewportWidth=meta.viewportWidth;hasMeta=!!(platform||browser||viewportWidth)}let metadataHTML="";if(reply.metadata){const{platform:platform,browser:browser,viewportWidth:viewportWidth}=deviceMetaData(reply.metadata);const metaParts=[];if(platform)metaParts.push(platform);if(browser)metaParts.push(browser);if(viewportWidth)metaParts.push(`${viewportWidth} px`);if(metaParts.length>0){metadataHTML=`\n          <div class="">\n            <p></p>\n            <small class="simple-commenter-comment-date">\n              ${metaParts.join(" Â· ")}\n            </small>\n          </div>\n        `}}const textHTML=document.createElement("p");textHTML.className="simple-commenter-title simple-commenter-title-bold";textHTML.innerHTML=reply.text;textHTML.style.whiteSpace="pre-wrap";const replyItemHTML=`\n    \n      ${simpleCommenterUserData.associated&&headerHTML}\n      ${textHTML.outerHTML}\n      ${metadataHTML}\n    `;const replyItem=document.createElement("div");replyItem.className="simple-commenter-reply";replyItem.innerHTML=replyItemHTML;return replyItem};const overlay=document.createElement("div");document.body.appendChild(overlay);document.addEventListener("mouseover",(function(e){if(commentInputUI){if(!hasCommentMarkerClass(e.target)){document.body.classList.add("simple-commenter-cursor-override")}else{exitCommentMode()}return}if(mode==="view"||mode==="disabled"){return}if(!hasCommentMarkerClass(e.target)){currentElement=e.target;document.body.classList.add("simple-commenter-cursor-override");setTimeout((()=>{showOverlay(currentElement)}),150)}else{overlay.className="simple-commenter-overlay";exitCommentMode()}}));document.addEventListener("click",(function(e){if(mode==="view"||mode==="disabled"){return}if(commentInputUI&&!commentInputUI.contains(e.target)&&!isDrawing&&!justFinishedDrawing&&shapes.length===0&&(!commentInputUI.querySelector(".simple-commenter-textarea")||commentInputUI.querySelector(".simple-commenter-textarea").value.length===0)){resetCommentInput();resetShapes();return}if(commentInputUI){return}if(e.target.getAttribute("data-disabled")==="true"){e.preventDefault()}if(!hasCommentMarkerClass(e.target)&&currentElement){const{xPercent:xPercent,yPercent:yPercent}=getRelativeClickPosition(e,currentElement);createCommentInputUI(e.clientX,e.clientY,currentElement,{xPercent:xPercent,yPercent:yPercent});e.preventDefault()}}),false);function changeMode(newMode){disabledBtn.classList.remove("simple-commenter-disabled-button");viewBtn.classList.remove("simple-commenter-view-button");activeBtn.classList.remove("simple-commenter-active-button");if(newMode==="disabled"){disabledBtn.classList.add("simple-commenter-disabled-button");enableAllButtons();hideComments();exitCommentMode();overlay.style.display="none";if(simpleCommenterUserData.theme.minimized||simpleCommenterUserData.login){showHideLoginContainer(true)}}else if(newMode==="view"){viewBtn.classList.add("simple-commenter-view-button");displayComments();enableAllButtons();hideCommentInput();exitCommentMode();overlay.style.display="none";if(simpleCommenterUserData.theme.minimized){scButton.style.display="none"}}else if(newMode==="active"){activeBtn.classList.add("simple-commenter-active-button");document.body.classList.add("simple-commenter-cursor-override");overlay.style.display="block";displayComments();disableAllButtons();if(simpleCommenterUserData.theme.minimized){scButton.style.display="none"}}mode=newMode;updateUserData({mode:newMode})}function hasCommentMarkerClass(element){while(element&&element!==document.body){if([...element.classList].some((className=>className.startsWith("simple-commenter-")))){return true}element=element.parentElement}return false}document.addEventListener("mouseout",(function(){overlay.className="simple-commenter-overlay";const shouldShowOverlay=commentInputUI&&!isDrawing&&!capturing&&shapes.length===0;overlay.style.display=shouldShowOverlay?"block":"none"}));document.addEventListener("keydown",(function(event){if(!active)return;if(commentInputUI&&(event.key==="c"||event.key==="C"||event.key==="h"||event.key==="H")){return}if(event.key==="c"||event.key==="C"){}else if(event.key==="Escape"){exitCommentMode();changeMode("view")}else if(event.key==="h"||event.key==="H"){}}));function disableAllButtons(){document.querySelectorAll("button:not(.simple-commenter-modebox button):not(.simple-commenter-button-green):not(.simple-commenter-x-button)").forEach((button=>{button.setAttribute("data-disabled","true")}));document.querySelectorAll("a:not(#simple-commenter-modebox a)").forEach((link=>{link.setAttribute("data-original-href",link.getAttribute("href"));link.setAttribute("href","#");link.setAttribute("data-disabled","true");link.addEventListener("click",preventNavigation)}))}function preventNavigation(e){e.preventDefault()}function enableAllButtons(){document.querySelectorAll("[data-disabled='true']").forEach((element=>{if(element.tagName.toLowerCase()==="a"){if(element.hasAttribute("data-original-href")){element.setAttribute("href",element.getAttribute("data-original-href"));element.removeEventListener("click",preventNavigation);element.removeAttribute("data-original-href")}}element.removeAttribute("data-disabled")}))}function showOverlay(element){const bounds=element.getBoundingClientRect();overlay.style.left=`${bounds.left+window.pageXOffset}px`;overlay.style.top=`${bounds.top+window.pageYOffset}px`;overlay.style.width=`${bounds.width}px`;overlay.style.height=`${bounds.height}px`;overlay.style.maxWidth=`calc(100vw - ${bounds.left}px)`;overlay.style.maxHeight=`calc(100vh - ${bounds.top}px)`;overlay.style.pointerEvents="none";overlay.style.display="block";overlay.className+=" simple-commenter-active"}function exitCommentMode(){document.body.classList.remove("simple-commenter-cursor-override")}function getRelativeClickPosition(event,element){const rect=element.getBoundingClientRect();const x=event.clientX-rect.left;const y=event.clientY-rect.top;const xPercent=x/rect.width;const yPercent=y/rect.height;return{xPercent:xPercent,yPercent:yPercent}}const addComment=async(title,text,element,relativePosition)=>{if(!element){console.error("No element provided for adding a comment.");return}if(text===""&&shapes.length<=0){alert("Please enter some text before submitting.");return}const xpath=getUniqueXPath(element);const metadata=await getUserMetadata();const comment={title:title||"",text:text,id:`comment-${commentIdCounter++}`,elementXPath:xpath,metadata:metadata,userData:simpleCommenterUserData,date:new Date,relativePosition:relativePosition};const sanitizedComment={...comment,title:escapeHTML(comment.title),text:escapeHTML(comment.text)};if(screenshotData){comment.screenshot=screenshotData}else if(shapes.length>0){const captured=await captureScreenshot();comment.screenshot=captured;resetShapes()}comments.push(sanitizedComment);await displayComments();updateCommentCount();updateCommentList();resetCommentInput();const response=await fetch(`${endpoint}addcomment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:domain,type:"addComment",token:simpleCommenterUserData.token,referrer:document?.URL,...comment})});const data=await response.json();if(response.ok){if(data.active===false){if(data.alert){console.error(data.message)}return}comments=data;await displayComments();updateCommentCount();updateCommentList();resetShapes();return data}resetShapes();console.error(data.message)};const replyComment=async(replyText,commentId)=>{if(!replyText){alert("Please enter some reply text.");return}const metadata=await getUserMetadata();const response=await fetch(`${endpoint}replycomment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:domain,referrer:document.URL,token:simpleCommenterUserData.token,commentId:commentId,reply:replyText,metadata:metadata,userData:simpleCommenterUserData})});const data=await response.json();if(response.ok){if(data.active===false){if(data.alert){console.error(data.message)}return}console.log(data);comments=data;await displayComments();const updatedComment=data.find((c=>c.id===commentId));if(!updatedComment){console.error("Updated comment not found in response.");return data}await displaySingleComment(updatedComment,true);return data}console.error(data.message)};function showPulse(x,y){removePulse();const pulseContainer=document.createElement("div");pulseContainer.className="simple-commenter-pulse-container";pulseContainer.id="simple-commenter-pulse";pulseContainer.style.left=`${x}px`;pulseContainer.style.top=`${y}px`;const pulseDot=document.createElement("div");pulseDot.className="simple-commenter-pulse-dot";const pulseAnim=document.createElement("div");pulseAnim.className="simple-commenter-pulse-anim";pulseContainer.appendChild(pulseAnim);pulseContainer.appendChild(pulseDot);document.body.appendChild(pulseContainer)}function removePulse(){const oldPulse=document.getElementById("simple-commenter-pulse");if(oldPulse){if(oldPulse._pulseTimeout)clearTimeout(oldPulse._pulseTimeout);oldPulse.remove()}}function escapeHTML(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function createCommentInputUI(x,y,currentElement,relativePosition){if(!currentElement){console.error("No element is currently selected for commenting.");return}if(commentInputUI)commentInputUI.remove();showOverlay(currentElement);showPulse(x,y);commentInputUI=document.createElement("div");commentInputUI.style=`position:fixed;`;commentInputUI.className="simple-commenter-container";commentInputUI.id="simple-commenter-comment-input";const{header:drawHeader,titleContainer:titleContainer,drawIconsContainer:drawIconsContainer,input:input}=createHeader();const commentBoxMenu=document.createElement("div");const whoCommentDiv=document.createElement("div");const commentContentContainer=document.createElement("div");whoCommentDiv.className="simple-commenter-space-between simple-commenter-comment-meta-container";let nameLabelDisplay=null;if(simpleCommenterUserData.name&&simpleCommenterUserData.name.trim()){nameLabelDisplay=document.createElement("p");nameLabelDisplay.classList.add("simple-commenter-xs");nameLabelDisplay.textContent=`${simpleCommenterUserData.name} `}else{const attachIdentityButton=createIconButton({icon:"user",ariaLabel:"Attach Identity",tooltip:localize("attachIdentity"),onClick:()=>{userContainer.style.display="block"}});if(simpleCommenterUserData.associated){whoCommentDiv.appendChild(attachIdentityButton)}}const drawButton=createIconButton({icon:"draw",ariaLabel:"Edit Mode",tooltip:localize("draw"),onClick:event=>{const svg=event.currentTarget.querySelector("svg");if(svg){svg.classList.toggle("simple-commenter-icons-active")}titleContainer.classList.toggle("simple-commenter-display-none");drawIconsContainer.classList.toggle("simple-commenter-display-none")}});const screenShotButton=createIconButton({icon:"screenshot",ariaLabel:"Attach Identity",tooltip:localize("screenshot"),onClick:async()=>{overlay.style.display="none";const data=await captureScreenshot();const screenshotButton=createScreenshotButton({screenshot:data});if(screenshotButton){commentContentContainer.appendChild(screenshotButton)}}});if(!isMobile){if(drawing){whoCommentDiv.appendChild(drawButton)}if(screenshots){whoCommentDiv.appendChild(screenShotButton)}}if(nameLabelDisplay){whoCommentDiv.appendChild(nameLabelDisplay)}commentBoxMenu.className="simple-commenter-comment-box-menu";const textarea=document.createElement("textarea");textarea.className="simple-commenter-textarea";textarea.placeholder=localize("enterCommentPlaceholder");const submitButton=document.createElement("button");submitButton.textContent=localize("post");submitButton.setAttribute("aria-label","Submit your comment");submitButton.className="simple-commenter-button";commentContentContainer.className="simple-commenter-comment-container simple-commenter-border-top";commentContentContainer.id="simple-commenter-comment-textarea";const viewportWidth=window.innerWidth-10;const viewportHeight=window.innerHeight-10;const estimatedWidth=360;const estimatedHeight=210;const xAdjusted=x+6;const yAdjusted=y+6;const computedLeft=Math.min(xAdjusted,viewportWidth-estimatedWidth);const computedTop=Math.min(yAdjusted,viewportHeight-estimatedHeight);commentInputUI.style.left=`${computedLeft}px`;commentInputUI.style.top=`${computedTop}px`;commentInputUI.style.zIndex="12111";submitButton.onclick=()=>{const title=input.value.trim();const text=textarea.value.trim();addComment(title,text,currentElement,relativePosition);removePulse()};commentInputUI.appendChild(drawHeader);commentContentContainer.appendChild(textarea);commentInputUI.appendChild(commentContentContainer);commentBoxMenu.appendChild(whoCommentDiv);commentBoxMenu.appendChild(submitButton);commentInputUI.appendChild(commentBoxMenu);document.body.appendChild(commentInputUI)}function hideComments(){commentInputUI=null;removePulse();document.querySelectorAll(".simple-commenter-comment-marker, .simple-commenter-comment-box, .simple-commenter-container").forEach((el=>el.remove()))}function hideCommentInput(){commentInputUI=null;document.querySelectorAll(".simple-commenter-container").forEach((el=>el.remove()));removePulse()}const displaySingleComment=async(comment,keepOpen=false)=>{const element=getElementByXPath(comment.elementXPath);let marker=document.querySelector(`.simple-commenter-comment-marker[data-id="${comment.id}"]`);if(!marker&&element){marker=document.createElement("div");marker.className="simple-commenter-comment-marker";marker.setAttribute("data-id",comment.id)}let commentBox=document.querySelector(`.simple-commenter-comment-box[data-id="${comment.id}"]`);let savedReplyValue="";let replyInputWasOpen=false;if(commentBox){const existingTextarea=commentBox.querySelector(".simple-commenter-textarea");if(existingTextarea){savedReplyValue=existingTextarea.value}const existingReplyInputContainer=commentBox.querySelector(".simple-commenter-reply-container");if(existingReplyInputContainer){replyInputWasOpen=existingReplyInputContainer.style.display==="flex"}}if(!commentBox){commentBox=document.createElement("div");commentBox.style.visibility=keepOpen?"visible":"hidden";commentBox.className="simple-commenter-comment-box";commentBox.setAttribute("data-id",comment.id)}else{commentBox.innerHTML=""}commentBox.addEventListener("click",(e=>{e.stopPropagation()}));const commentContentContainer=document.createElement("div");commentContentContainer.className="simple-commenter-comment-container simple-commenter-border-radius-top";commentContentContainer.setAttribute("data-id",comment.id);const commentTitleComponent=createCommentItem(comment,false);commentContentContainer.appendChild(commentTitleComponent);commentBox.appendChild(commentContentContainer);const replyInputContainer=document.createElement("div");replyInputContainer.className="simple-commenter-reply-container";replyInputContainer.style.display="none";replyInputContainer.setAttribute("data-id",comment.id);const replyTextarea=document.createElement("textarea");replyTextarea.className="simple-commenter-textarea";replyTextarea.placeholder=localize("addReplyPlaceholder");replyTextarea.setAttribute("data-id",comment.id);replyTextarea.setAttribute("rows","2");replyTextarea.value=savedReplyValue;if(replyInputWasOpen||savedReplyValue){replyInputContainer.style.display="flex"}const replyButtonContainer=document.createElement("div");replyButtonContainer.className="simple-commenter-reply-buttons-container";const whoCommentDiv=document.createElement("div");whoCommentDiv.className="simple-commenter-comment-meta";if(simpleCommenterUserData.name&&simpleCommenterUserData.name.trim()){whoCommentDiv.innerHTML=`\n        <p class="simple-commenter-comment-meta">\n          As ${simpleCommenterUserData.name}\n        </p>\n      `}else{const attachIdentityButton=createIconButton({icon:"user",ariaLabel:"Attach Identity",tooltip:localize("attachIdentity"),onClick:()=>{userContainer.style.display="block";userButton.classList.add("simple-commenter-active-button");if(commentInputUI){resetCommentInput()}}});whoCommentDiv.appendChild(attachIdentityButton)}const addReplyButton=document.createElement("button");addReplyButton.textContent=localize("addReply");addReplyButton.className="simple-commenter-button";addReplyButton.setAttribute("data-id",comment.id);const commentBoxMenu=document.createElement("div");commentBoxMenu.className="simple-commenter-comment-box-menu";commentBoxMenu.setAttribute("data-id",comment.id);const commentBoxButtons=document.createElement("div");commentBoxButtons.className="simple-commenter-comment-box-buttons";commentBoxButtons.setAttribute("data-id",comment.id);const deleteButton=createButton({text:localize("resolve"),ariaLabel:"Resolve Comment",className:"simple-commenter-text-sm",dataId:comment.id,condition:resolveSettings,onClick:()=>{deleteComment(comment.id);marker.remove();commentBox.remove();xButton.remove()}});const replyButton=document.createElement("button");replyButton.textContent=localize("reply");replyButton.className="simple-commenter-button-green simple-commenter-text-sm";replyButton.setAttribute("data-id",comment.id);const dateLabel=document.createElement("span");dateLabel.className="simple-commenter-comment-date-large";dateLabel.textContent=`${timeAgo(comment.date)}`;if(element){Array.from(marker.querySelectorAll("svg")).forEach((svg=>svg.remove()));const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("fill","none");svg.setAttribute("viewBox","0 0 24 24");svg.setAttribute("strokeLinecap","1.5");svg.style.width="20px";svg.style.height="20px";svg.style.display="block";svg.innerHTML=`<path\n        fillRule="evenodd"\n        d="M4.848 2.771A49.144 49.144 0 0 1 12 2.25c2.43 0 4.817.178 7.152.52 1.978.292 3.348 2.024 3.348 3.97v6.02c0 1.946-1.37 3.678-3.348 3.97-1.94.284-3.916.455-5.922.505a.39.39 0 0 0-.266.112L8.78 21.53A.75.75 0 0 1 7.5 21v-3.955a48.842 48.842 0 0 1-2.652-.316c-1.978-.29-3.348-2.024-3.348-3.97V6.741c0-1.946 1.37-3.68 3.348-3.97Z"\n        clipRule="evenodd"\n      /> `;marker.appendChild(svg)}const xButton=createCloseButton();if(!element){comment.isError=true;updateCommentList()}if(element&&getComputedStyle(element).display==="none"){comment.isError=true;updateCommentList();return}if(element){comment.isError=false}const isMarkerFixed=setupCommentElements(element,marker,commentBox,xButton,deleteButton,replyButton,replyInputContainer,replyTextarea,addReplyButton,comment);if(element){document.body.appendChild(marker)}document.body.appendChild(commentBox);commentBoxMenu.appendChild(dateLabel);commentBoxMenu.appendChild(commentBoxButtons);commentBoxButtons.appendChild(deleteButton);commentBoxButtons.appendChild(replyButton);replyInputContainer.appendChild(replyTextarea);replyButtonContainer.appendChild(whoCommentDiv);replyButtonContainer.appendChild(addReplyButton);replyInputContainer.appendChild(replyButtonContainer);commentBox.appendChild(commentBoxMenu);commentBox.appendChild(xButton);commentContentContainer.appendChild(replyInputContainer)};const displayComments=async()=>{document.querySelectorAll(".simple-commenter-comment-marker, .simple-commenter-comment-box").forEach((el=>el.remove()));comments.forEach((async comment=>{await displaySingleComment(comment)}));let resizeTimeout;window.addEventListener("resize",(function(){clearTimeout(resizeTimeout);resizeTimeout=setTimeout((function(){comments.forEach((comment=>{const element=getElementByXPath(comment.elementXPath);let hidden=false;if(!element)hidden=true;const marker=document.querySelector(`.simple-commenter-comment-marker[data-id="${comment.id}"]`);const commentBox=document.querySelector(`.simple-commenter-comment-box[data-id="${comment.id}"]`);const xButton=document.querySelector(`button[data-id="${comment.id}"]`);const deleteButton=document.querySelector(`.simple-commenter-button-red[data-id="${comment.id}"]`);const replyButton=document.querySelector(`.simple-commenter-button-green[data-id="${comment.id}"]`);const replyInputContainer=document.querySelector(`.simple-commenter-reply-container[data-id="${comment.id}"]`);const replyTextarea=document.querySelector(`.simple-commenter-textarea[data-id="${comment.id}"]`);const addReplyButton=document.querySelector(`.simple-commenter-button[data-id="${comment.id}"]`);if(marker&&commentBox&&xButton){setupCommentElements(element,marker,commentBox,xButton,deleteButton,replyButton,replyInputContainer,replyTextarea,addReplyButton,comment,hidden)}}))}),100)}))};function isStickyOrFixed(el){while(el){const style=getComputedStyle(el);if(style.position==="sticky"||style.position==="fixed"){return true}el=el.parentElement}return false}function hasValidRelativePosition(comment){return comment.relativePosition&&typeof comment.relativePosition.xPercent==="number"&&typeof comment.relativePosition.yPercent==="number"}function setupCommentElements(element,marker,commentBox,xButton,deleteButton,replyButton,replyInputContainer,replyTextarea,addReplyButton,comment,hidden=false){const markerWidth=52;const markerHeight=48;const viewportWidth=window.innerWidth;let markerLeft;let markerTop;let useFixed=false;if(element&&hasValidRelativePosition(comment)){const rect=element.getBoundingClientRect();useFixed=isStickyOrFixed(element);const relX=comment.relativePosition.xPercent*rect.width;const relY=comment.relativePosition.yPercent*rect.height;if(useFixed){markerLeft=rect.left+relX-markerWidth/2;markerTop=rect.top+relY-markerHeight/2}else{markerLeft=window.scrollX+rect.left+relX-markerWidth/2;markerTop=window.scrollY+rect.top+relY-markerHeight/2}}else if(element){const rect=element.getBoundingClientRect();useFixed=isStickyOrFixed(element);if(useFixed){markerLeft=rect.right-30;markerTop=rect.top-markerHeight/2;markerLeft=Math.max(0,Math.min(markerLeft,viewportWidth-markerWidth))}else{markerLeft=window.scrollX+rect.right-30;markerTop=window.scrollY+rect.top-markerHeight/2}}else{markerLeft=window.scrollX+viewportWidth-30;markerTop=window.scrollY+0-markerHeight/2}if(markerLeft+markerWidth>viewportWidth){markerLeft=viewportWidth-markerWidth}if(markerTop<0){markerTop=0}if(!marker){marker=document.createElement("div");document.body.appendChild(marker)}marker.style.position=useFixed?"fixed":"absolute";marker.style.left=`${markerLeft}px`;marker.style.top=`${markerTop}px`;setTimeout((()=>{adjustPosition(commentBox,markerLeft,markerTop,useFixed)}),100);marker.onclick=()=>{adjustPosition(commentBox,markerLeft,markerTop,useFixed);commentBox.style.visibility=commentBox.style.visibility==="hidden"?"visible":"hidden"};commentBox.onchange=async()=>{adjustPosition(commentBox,markerLeft,markerTop,useFixed);xButton.style.visibility=commentBox.style.visibility==="hidden"?"visible":"hidden"};xButton.onclick=()=>{commentBox.style.visibility="hidden"};replyButton.onclick=()=>{replyInputContainer.style.display="flex";adjustPosition(commentBox,markerLeft,markerTop,useFixed)};addReplyButton.onclick=async()=>{const replyText=replyTextarea.value.trim();if(!replyText){alert("Please enter a reply.");return}try{await replyComment(replyText,commentId=comment.id);replyTextarea.value="";replyInputContainer.style.display="none"}catch(error){console.error(error);alert("Error submitting reply.")}};return useFixed}function adjustPosition(commentBox,markerLeft,markerTop,useFixed){const markerHeight=48;const commentBoxWidth=commentBox.offsetWidth;const commentBoxHeight=commentBox.offsetHeight;commentBox.style.position=useFixed?"fixed":"absolute";let commentBoxLeft=markerLeft;let commentBoxTop;if(useFixed){const viewportWidth=window.innerWidth;const viewportHeight=window.innerHeight;if(commentBoxLeft+commentBoxWidth>viewportWidth){commentBoxLeft=viewportWidth-commentBoxWidth-12}if(commentBoxLeft<0){commentBoxLeft=0}commentBoxTop=markerTop-commentBoxHeight;if(commentBoxTop<0){commentBoxTop=markerTop+markerHeight}if(commentBoxTop+commentBoxHeight>viewportHeight){commentBoxTop=viewportHeight-commentBoxHeight-12}if(commentBoxTop<0){commentBoxTop=0}}else{const viewportWidth=window.innerWidth;if(commentBoxLeft+commentBoxWidth>viewportWidth){commentBoxLeft=viewportWidth-commentBoxWidth-12}if(commentBoxLeft<0){commentBoxLeft=0}commentBoxTop=markerTop-commentBoxHeight;if(commentBoxTop<window.scrollY){commentBoxTop=markerTop+markerHeight}}commentBox.style.left=`${commentBoxLeft}px`;commentBox.style.top=`${commentBoxTop}px`}function hasAdminBar(adminSelectors=["#wpadminbar",".admin-bar"]){try{for(const selector of adminSelectors){if(document.querySelector(selector)){console.log(`Admin bar detected: ${selector}`);return true}}}catch(e){console.error("Error checking for admin bar:",e)}return false}function hasWordPressAdminBar(){try{if(document.querySelector("#wpadminbar")){return true}}catch(e){console.error("Error checking for WordPress admin bar:",e)}return false}function isElementVisible(element){let el=element;while(el){const style=getComputedStyle(el);if(style.display==="none"||style.visibility==="hidden"){return false}el=el.parentElement}if(isStickyOrFixed(element)){const rect=element.getBoundingClientRect();if(rect.top<-20||rect.bottom<0){return false}}return true}function getElementByXPath(xpath,{ignoreVisibility:ignoreVisibility=false}={}){let newXpath=xpath;if(adminBar&&hasWordPressAdminBar()){newXpath=newXpath.replace("/html/body/div[1]","/html/body/div[2]")}try{const namespaceResolver=prefix=>{const ns={xhtml:"http://www.w3.org/1999/xhtml",svg:"http://www.w3.org/2000/svg"};return ns[prefix]||null};let result=document.evaluate(xpath,document,namespaceResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!result&&newXpath!==xpath){result=document.evaluate(newXpath,document,namespaceResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}if(ignoreVisibility){return result}if(result&&!isElementVisible(result)){return null}return result}catch(error){console.error("Error finding element by XPath:",error)}}function getUniqueXPath(element){const rootElement=document.body;const sliceTags=["svg"];let elements=[];let currentElement=element;try{while(currentElement!==rootElement){let index=1;let sibling=currentElement.previousElementSibling;while(sibling){if(sibling.nodeName===currentElement.nodeName){index++}sibling=sibling.previousElementSibling}const tagName=currentElement.tagName.toLowerCase();elements.unshift(`${tagName}[${index}]`);currentElement=currentElement.parentElement}let sliceIndex=-1;for(let tag of sliceTags){let index=elements.findIndex((element=>element.startsWith(tag)));if(index!==-1&&(sliceIndex===-1||index<sliceIndex)){sliceIndex=index}}if(sliceIndex!==-1){elements=elements.slice(0,sliceIndex)}let xpath=`/html/body/${elements.join("/")}`;if(adminBar&&hasWordPressAdminBar()){console.log("Adjusting XPath for WordPress admin bar:",xpath);xpath=xpath.replace("/html/body/div[2]","/html/body/div[1]");console.log("Adjusted XPath:",xpath)}return xpath}catch(error){console.log("Error getting unique XPath:",error)}}const deleteComment=async commentId=>{const response=await fetch(`${endpoint}deletecomment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:domain,referrer:document.URL,commentId:commentId,token:simpleCommenterUserData.token})});const data=await response.json();if(response.ok){if(data.active===false){if(data.alert){console.error(data.message)}return}comments=data;await displayComments();updateCommentCount();updateCommentList();return data}console.error(data.message)};function svgToDataUrl(svgString){const encoded=encodeURIComponent(svgString).replace(/'/g,"%27").replace(/"/g,"%22");return`url("data:image/svg+xml,${encoded}") 6 6, auto`}const iconSvgs={check:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="currentColor"\n        class="simple-commenter-icons simple-commenter-check-badge"\n      >\n        <path\n          fill-rule="evenodd"\n          d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z"\n          clip-rule="evenodd"\n        />\n      </svg>\n    `,unverified:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        viewBox="0 0 24 24"\n        fill="currentColor"\n        class="simple-commenter-icons simple-commenter-check-badge"\n      >\n        <path\n          fill-rule="evenodd"\n          d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm11.378-3.917c-.89-.777-2.366-.777-3.255 0a.75.75 0 0 1-.988-1.129c1.454-1.272 3.776-1.272 5.23 0 1.513 1.324 1.513 3.518 0 4.842a3.75 3.75 0 0 1-.837.552c-.676.328-1.028.774-1.028 1.152v.75a.75.75 0 0 1-1.5 0v-.75c0-1.279 1.06-2.107 1.875-2.502.182-.088.351-.199.503-.331.83-.727.83-1.857 0-2.584ZM12 18a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"\n          clip-rule="evenodd"\n        />\n      </svg>\n    `,move:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons simple-commenter-fill"\n      >\n        <circle cx="7.75" cy="3.75" r="1.75" />\n        <circle cx="15.3864" cy="3.75" r="1.75" />\n        <circle cx="7.75" cy="11.3864" r="1.75" />\n        <circle cx="15.3864" cy="11.3864" r="1.75" />\n        <circle cx="7.75" cy="19.0227" r="1.75" />\n        <circle cx="15.3864" cy="19.0227" r="1.75" />\n      </svg>\n    `,delete:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M3 21L21 3M3 3L21 21"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,user:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M19 7.5V10.5M19 10.5V13.5M19 10.5H22M19 10.5H16M13.75 6.375C13.75 7.27011 13.3944 8.12855 12.7615 8.76149C12.1285 9.39442 11.2701 9.75 10.375 9.75C9.47989 9.75 8.62145 9.39442 7.98851 8.76149C7.35558 8.12855 7 7.27011 7 6.375C7 5.47989 7.35558 4.62145 7.98851 3.98851C8.62145 3.35558 9.47989 3 10.375 3C11.2701 3 12.1285 3.35558 12.7615 3.98851C13.3944 4.62145 13.75 5.47989 13.75 6.375ZM4 19.235V19.125C4 17.4342 4.67165 15.8127 5.86719 14.6172C7.06274 13.4216 8.68424 12.75 10.375 12.75C12.0658 12.75 13.6873 13.4216 14.8828 14.6172C16.0784 15.8127 16.75 17.4342 16.75 19.125V19.234C14.8255 20.3931 12.6206 21.0038 10.374 21C8.043 21 5.862 20.355 4 19.234V19.235Z"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,upload:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M18.1548 12.6822L11.0724 19.7834C10.2954 20.5624 9.24165 21 8.14289 21C7.04413 21 5.99037 20.5624 5.21342 19.7834C4.43648 19.0044 4 17.9478 4 16.8462C4 15.7445 4.43648 14.688 5.21342 13.909L15.2852 3.81068C15.5417 3.55358 15.8463 3.34966 16.1814 3.21056C16.5166 3.07146 16.8758 2.99991 17.2385 3C17.6012 3.00009 17.9604 3.0718 18.2955 3.21106C18.6306 3.35032 18.935 3.55438 19.1914 3.81161C19.4479 4.06883 19.6513 4.37418 19.79 4.71022C19.9287 5.04625 20.0001 5.40639 20 5.77008C19.9999 6.13376 19.9284 6.49387 19.7895 6.82984C19.6506 7.16581 19.4471 7.47106 19.1905 7.72817L9.1114 17.8339C8.84992 18.0852 8.50043 18.2225 8.13824 18.2179C7.77604 18.2133 7.43016 18.0662 7.17512 17.8083C6.92008 17.5505 6.77631 17.2024 6.77479 16.8392C6.77327 16.4761 6.91414 16.1268 7.16701 15.8668L14.3572 8.65769M9.11968 17.8246L9.11048 17.8339"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,draw:`<svg\n      xmlns="http://www.w3.org/2000/svg"\n      fill="none"\n      viewBox="0 0 24 24"\n      stroke-width="1.5"\n      stroke="currentColor"\n      class="simple-commenter-icons"\n    >\n      <path\n        d="M18.0466 4.26705L19.7561 2.55656C20.1125 2.2002 20.5958 2 21.0998 2C21.6037 2 22.0871 2.2002 22.4434 2.55656C22.7998 2.91292 23 3.39625 23 3.90023C23 4.4042 22.7998 4.88753 22.4434 5.24389L11.683 16.0043C11.1473 16.5397 10.4866 16.9333 9.76072 17.1494L7.03996 17.96L7.85062 15.2393C8.06673 14.5134 8.46026 13.8527 8.99567 13.317L18.0466 4.26705ZM18.0466 4.26705L20.7198 6.94019M19.1998 13.9068V18.72C19.1998 19.3247 18.9596 19.9046 18.532 20.3322C18.1044 20.7598 17.5245 21 16.9198 21H6.27997C5.67528 21 5.09536 20.7598 4.66779 20.3322C4.24021 19.9046 4 19.3247 4 18.72V8.08017C4 7.47548 4.24021 6.89557 4.66779 6.46799C5.09536 6.04041 5.67528 5.8002 6.27997 5.8002H11.0932"\n        stroke-width="1.5"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n      />\n    </svg> `,screenshot:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M7.09091 3H5.45455C4.80356 3 4.17924 3.2586 3.71892 3.71892C3.2586 4.17924 3 4.80356 3 5.45455V7.09091M16.9091 3H18.5455C19.1964 3 19.8208 3.2586 20.2811 3.71892C20.7414 4.17924 21 4.80356 21 5.45455V7.09091M21 16.9091V18.5455C21 19.1964 20.7414 19.8208 20.2811 20.2811C19.8208 20.7414 19.1964 21 18.5455 21H16.9091M7.09091 21H5.45455C4.80356 21 4.17924 20.7414 3.71892 20.2811C3.2586 19.8208 3 19.1964 3 18.5455V16.9091M15.2727 12C15.2727 12.868 14.9279 13.7004 14.3142 14.3142C13.7004 14.9279 12.868 15.2727 12 15.2727C11.132 15.2727 10.2996 14.9279 9.68583 14.3142C9.07208 13.7004 8.72727 12.868 8.72727 12C8.72727 11.132 9.07208 10.2996 9.68583 9.68583C10.2996 9.07208 11.132 8.72727 12 8.72727C12.868 8.72727 13.7004 9.07208 14.3142 9.68583C14.9279 10.2996 15.2727 11.132 15.2727 12Z"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,record:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M15.75 10.5L20.47 5.78C20.5749 5.67524 20.7085 5.60392 20.8539 5.57503C20.9993 5.54615 21.15 5.561 21.2869 5.61771C21.4239 5.67442 21.541 5.77045 21.6234 5.89367C21.7058 6.01688 21.7499 6.16176 21.75 6.31V17.69C21.7499 17.8382 21.7058 17.9831 21.6234 18.1063C21.541 18.2295 21.4239 18.3256 21.2869 18.3823C21.15 18.439 20.9993 18.4538 20.8539 18.425C20.7085 18.3961 20.5749 18.3248 20.47 18.22L15.75 13.5M4.5 18.75H13.5C14.0967 18.75 14.669 18.5129 15.091 18.091C15.5129 17.669 15.75 17.0967 15.75 16.5V7.5C15.75 6.90326 15.5129 6.33097 15.091 5.90901C14.669 5.48705 14.0967 5.25 13.5 5.25H4.5C3.90326 5.25 3.33097 5.48705 2.90901 5.90901C2.48705 6.33097 2.25 6.90326 2.25 7.5V16.5C2.25 17.0967 2.48705 17.669 2.90901 18.091C3.33097 18.5129 3.90326 18.75 4.5 18.75Z"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,marker:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M10.6179 15.8055C10.3742 15.2102 9.92935 14.7174 9.35941 14.4115C8.78947 14.1055 8.12993 14.0055 7.49377 14.1286C6.85761 14.2516 6.28441 14.5901 5.87235 15.0859C5.46029 15.5818 5.235 16.2042 5.23507 16.8466C5.23507 17.131 5.17614 17.4123 5.06193 17.6732C4.94772 17.9341 4.78066 18.1689 4.57111 18.3632C4.36156 18.5575 4.11399 18.707 3.84373 18.8026C3.57348 18.8981 3.2863 18.9376 3 18.9187C3.46047 19.7115 4.17214 20.3314 5.02453 20.6823C5.87692 21.0332 6.82235 21.0954 7.71404 20.8592C8.60574 20.623 9.39381 20.1016 9.95593 19.3761C10.518 18.6505 10.8228 17.7613 10.8228 16.8466C10.8228 16.4783 10.7501 16.1267 10.6179 15.8055ZM10.6179 15.8055C11.7252 15.4315 12.7842 14.9297 13.773 14.3102M9.0766 14.2872C9.45396 13.1874 9.96098 12.1356 10.5871 11.1536M13.7721 14.3102C15.5381 13.2044 17.0497 11.7427 18.2087 10.0202L21.8184 4.65401C21.9567 4.44962 22.0191 4.204 21.9949 3.95909C21.9708 3.71417 21.8616 3.48516 21.686 3.31116C21.5105 3.13715 21.2794 3.02895 21.0323 3.00503C20.7852 2.98111 20.5373 3.04296 20.3311 3.18001L14.9167 6.7584C13.1784 7.90672 11.7033 9.40452 10.5871 11.1546C12.0044 11.7826 13.1384 12.9065 13.7721 14.3112"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,pen:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M16.4878 5.06513L18.045 3.50699C18.3697 3.18237 18.8099 3 19.269 3C19.7281 3 20.1684 3.18237 20.493 3.50699C20.8176 3.83161 21 4.27189 21 4.73098C21 5.19006 20.8176 5.63034 20.493 5.95496L7.22948 19.2185C6.74148 19.7062 6.13968 20.0647 5.47843 20.2615L3 21L3.73845 18.5216C3.93532 17.8603 4.2938 17.2585 4.78152 16.7705L16.4888 5.06513H16.4878ZM16.4878 5.06513L18.9229 7.50017"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,arrow:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M4 21L20 3M20 3L16 3.5M20 3V7"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,x:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons simple-commenter-icons-small"\n      >\n        <path\n          d="M3 21L21 3M3 3L21 21"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,line:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M4 21L20 3"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,circle:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,square:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          d="M17.8235 3H6.17647C4.42215 3 3 4.42215 3 6.17647V17.8235C3 19.5778 4.42215 21 6.17647 21H17.8235C19.5778 21 21 19.5778 21 17.8235V6.17647C21 4.42215 19.5778 3 17.8235 3Z"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,back:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons simple-commenter-btn-unavailable"\n      >\n        <path\n          d="M9.66252 12.0012L5 7.4994M5 7.4994L9.66252 3M5 7.4994H19V21"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,forward:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons simple-commenter-btn-unavailable"\n      >\n        <path\n          d="M14.3375 12.0012L19 7.4994M19 7.4994L14.3375 3M19 7.4994H5V21"\n          stroke-width="1.5"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,visible:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons simple-commenter-btn-unavailable"\n      >\n        <path\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"\n        />\n        <path\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"\n        />\n      </svg>\n    `,hidden:`<svg\n      xmlns="http://www.w3.org/2000/svg"\n      fill="none"\n      viewBox="0 0 24 24"\n      stroke-width="1.5"\n      stroke="currentColor"\n      class="simple-commenter-icons simple-commenter-icons-active"\n    >\n      <path\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"\n      />\n    </svg> `,color:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons simple-commenter-background-primary"\n      >\n        <circle\n          cx="12"\n          cy="12"\n          r="9"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n        />\n      </svg>\n    `,photo:`\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        fill="none"\n        viewBox="0 0 24 24"\n        stroke-width="1.5"\n        stroke="currentColor"\n        class="simple-commenter-icons"\n      >\n        <path\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"\n        />\n      </svg>\n    `,simpleCommenter:`\n      <div class="simple-commenter-logo simple-commenter-transition">\n        <svg\n          width="44"\n          height="39"\n          viewBox="0 0 44 39"\n          fill="none"\n          xmlns="http://www.w3.org/2000/svg"\n          class="simple-commenter-icons-logo"\n        >\n          <path\n            d="M6.79968 22.7283C6.79968 25.3655 8.75121 27.6862 11.5466 28.0555C13.4454 28.3192 12.4433 30.3762 14.3948 30.4817L13.5509 35.5978L22.2536 28.8994C22.7283 28.4247 25.6293 28.8994 26.3149 28.8994C29.6378 28.7939 33.0134 28.5301 36.2835 28.0555C39.079 27.6862 41.0305 25.3655 41.0305 22.7283V12.7597C41.0305 10.1225 39.079 7.80179 36.2835 7.43259C32.2222 6.8524 28.1082 6.58868 23.9415 6.58868C19.7219 6.58868 15.6079 6.8524 11.5466 7.43259C8.75121 7.80179 6.79968 10.1225 6.79968 12.7597V22.7283Z"\n            fill="#F7D070"\n            class="simple-commenter-logo-fill"\n          />\n          <path\n            d="M41.8744 8.75122V21.9899C41.8744 24.8381 39.8701 27.2643 37.1802 27.6335C33.1189 28.2137 29.0049 28.5829 24.8909 28.6884C24.2579 28.6884 23.6777 28.8466 23.1503 29.0576C22.6229 29.2686 22.0954 29.6378 21.6735 30.0598L15.1332 36.6V29.9015C15.1332 29.1631 14.553 28.5302 13.8146 28.4774C11.3884 28.2665 9.01494 28.0027 6.69421 27.6863C4.00427 27.2643 2 24.8909 2 22.0427V8.75122C2 5.90305 4.00427 3.47683 6.69421 3.10762C11.7049 2.36921 16.7683 2 21.9372 2C27.0534 2 32.1695 2.36921 37.1802 3.10762C39.8701 3.47683 41.8744 5.90305 41.8744 8.75122Z"\n            stroke="#222222"\n            stroke-width="2.5"\n            stroke-linejoin="round"\n          />\n        </svg>\n      </div>\n    `,commentArrow:`\n      <svg\n        width="22"\n        height="22"\n        viewBox="0 0 28 28"\n        fill="none"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <path\n          d="M3.52903 2H14C20.629 2 26 7.37097 26 14C26 20.629 20.629 26 14 26C7.37097 26 2 20.629 2 14V3.52903C2 2.6871 2.6871 2 3.52903 2Z"\n          fill="#F7D070"\n          stroke="black"\n          stroke-width="1"\n          class="simple-commenter-logo-fill"\n        />\n        <path\n          d="M7.51611 14H20.4839"\n          stroke="black"\n          stroke-width="1.4"\n          stroke-miterlimit="10"\n          stroke-linecap="round"\n        />\n        <path\n          d="M14 8V20.9677"\n          stroke="black"\n          stroke-width="1.4"\n          stroke-miterlimit="10"\n          stroke-linecap="round"\n        />\n      </svg>\n    `};const generateCommentArrow=fillColor=>`\n    <svg\n      width="22"\n      height="22"\n      viewBox="0 0 28 28"\n      fill="none"\n      xmlns="http://www.w3.org/2000/svg"\n    >\n      <path\n        d="M3.52903 2H14C20.629 2 26 7.37097 26 14C26 20.629 20.629 26 14 26C7.37097 26 2 20.629 2 14V3.52903C2 2.6871 2.6871 2 3.52903 2Z"\n        fill="${fillColor}"\n        stroke="black"\n        stroke-width="1"\n        class="simple-commenter-logo-fill"\n      />\n      <path\n        d="M7.51611 14H20.4839"\n        stroke="black"\n        stroke-width="1.4"\n        stroke-miterlimit="10"\n        stroke-linecap="round"\n      />\n      <path\n        d="M14 8V20.9677"\n        stroke="black"\n        stroke-width="1.4"\n        stroke-miterlimit="10"\n        stroke-linecap="round"\n      />\n    </svg>\n  `;function createButton({ariaLabel:ariaLabel,dataId:dataId,onClick:onClick,className:className,onMouseDown:onMouseDown,text:text,dataColor:dataColor,position:position,condition:condition}){if(condition)return document.createComment("button removed by condition");const button=document.createElement("button");button.innerHTML=text||"";button.setAttribute("aria-label",ariaLabel);button.classList.add("simple-commenter-button-green");if(className)button.classList.add(className);if(dataId)button.setAttribute("data-id",dataId);if(dataColor)button.dataset.color=dataColor;if(position)button.style.position=position;if(onClick)button.addEventListener("click",onClick);if(onMouseDown){button.addEventListener("mousedown",onMouseDown);button.addEventListener("touchstart",onMouseDown,{passive:false})}return button}function createIcon({icon:icon,ariaLabel:ariaLabel,className:className,color:color,text:text}){const iconElement=document.createElement("span");iconElement.innerHTML=iconSvgs[icon]||"";iconElement.setAttribute("aria-label",ariaLabel);iconElement.classList.add("simple-commenter-icon-button-div");if(className)iconElement.classList.add(className);if(text){const textElement=document.createElement("span");textElement.textContent=text;textElement.classList.add("simple-commenter-icon-text");iconElement.appendChild(textElement)}if(color){const svg=iconElement.querySelector("svg");if(svg){svg.style.fill=color}}return iconElement}function createIconButton({icon:icon,ariaLabel:ariaLabel,dataId:dataId,onClick:onClick,className:className,onMouseDown:onMouseDown,color:color,dataColor:dataColor,position:position,tooltip:tooltip}){const button=document.createElement("button");button.innerHTML=iconSvgs[icon]||"";button.setAttribute("aria-label",ariaLabel);button.classList.add("simple-commenter-comment-meta-button");if(color){const svg=button.querySelector("svg");if(svg){svg.style.fill=color}}if(tooltip){const tooltipEl=document.createElement("p");tooltipEl.className="simple-commenter-tooltip";tooltipEl.textContent=tooltip;button.appendChild(tooltipEl);button.addEventListener("mouseenter",(()=>{tooltipEl.classList.add("visible")}));button.addEventListener("mouseleave",(()=>{tooltipEl.classList.remove("visible")}))}if(className)button.classList.add(className);if(dataId)button.setAttribute("data-id",dataId);if(dataColor)button.dataset.color=dataColor;if(position)button.style.position=position;if(onClick)button.addEventListener("click",onClick);if(onMouseDown){button.addEventListener("mousedown",onMouseDown);button.addEventListener("touchstart",onMouseDown,{passive:false})}return button}function createColorPicker(){const picker=document.createElement("div");picker.className="simple-commenter-color-picker  simple-commenter-display-none";picker.style.position="absolute";const primaryColor="#800080";const colors=[{name:"primary",value:theme?.primary||"purple"},{name:"red",value:"#E66A6A"},{name:"blue",value:"#62B0E8"},{name:"green",value:"#7BC47F"},{name:"white",value:"#FFFFFF"},{name:"black",value:"#000000"}];colors.forEach((colorInfo=>{const optionButton=createIconButton({icon:"color",ariaLabel:`Select color ${colorInfo.name}`,className:"simple-commenter-color-option",color:colorInfo.value,dataColor:colorInfo.value,onClick:event=>{event.stopPropagation();selectedColorValue=event.currentTarget.dataset.color;applyShapeColor(selectedColorValue);picker.classList.add("simple-commenter-display-none")}});picker.appendChild(optionButton)}));return picker}function createTextButton({text:text,ariaLabel:ariaLabel,dataId:dataId,onClick:onClick,className:className,onMouseDown:onMouseDown}){const button=document.createElement("button");button.setAttribute("aria-label",ariaLabel);button.classList.add("simple-commenter-button-green");button.textContent=text||"";if(className)button.classList.add(className);if(dataId)button.setAttribute("data-id",dataId);if(onClick)button.addEventListener("click",onClick);if(onMouseDown){button.addEventListener("mousedown",onMouseDown);button.addEventListener("touchstart",onMouseDown,{passive:false})}return button}function createScreenshotButton({screenshot:screenshot}){if(!screenshot||!screenshot.imgSmall){return null}const screenshotButton=document.createElement("button");screenshotButton.classList.add("simple-commenter-screenshot-container");const screenshotDiv=document.createElement("div");const imgElement=document.createElement("img");imgElement.src=screenshot.imgSmall;imgElement.alt="Screenshot Preview";imgElement.style.maxWidth="40px";imgElement.style.maxHeight="40px";const textDiv=document.createElement("div");textDiv.textContent=localize("viewScreenshot");textDiv.className="simple-commenter-screenshot-text";screenshotButton.addEventListener("click",(e=>{showScreenshotGallery({screenshot:screenshot})}));screenshotButton.appendChild(screenshotDiv);screenshotDiv.appendChild(imgElement);screenshotButton.appendChild(textDiv);return screenshotButton}function createHeader(){const header=document.createElement("div");header.className="simple-commenter-comment-container simple-commenter-p-0 simple-commenter-flex-row simple-commenter-gap-0 simple-commenter-border-radius-top";const titleContainer=document.createElement("div");titleContainer.className="simple-commenter-flex-1";const input=document.createElement("input");input.className="simple-commenter-textarea simple-commenter-title-input";input.placeholder=localize("enterCommentTitlePlaceholder");titleContainer.appendChild(input);const moveContainer=document.createElement("div");moveContainer.className="simple-commenter-move-button";const drawIconsContainer=document.createElement("div");drawIconsContainer.className="simple-commenter-comment-meta simple-commenter-flex-1 simple-commenter-gap-1 simple-commenter-draw-icons-div simple-commenter-display-none";const drawIconsActionContainer=document.createElement("div");drawIconsActionContainer.className="simple-commenter-flex";const xButton=createIconButton({icon:"x",ariaLabel:"Close CommentBox",className:"simple-commenter-m-1-5",onClick:()=>{resetCommentInput();resetShapes();toggleCommentboxEyeVisiblity()}});let isDragging=false;let dragStartX,dragStartY;const moveBtn=createIconButton({icon:"move",ariaLabel:"Move CommentBox",className:"simple-commenter-move-btn",onMouseDown:event=>{if(!commentInputUI||!commentInputUI.style){console.error("No commentInputUI element found for dragging:",commentInputUI);return}const svg=event.currentTarget.querySelector("svg");if(!svg){console.error("SVG element not found in move button");return}const getClientX=e=>e.touches?e.touches[0].clientX:e.clientX;const getClientY=e=>e.touches?e.touches[0].clientY:e.clientY;const startDrag=e=>{e.preventDefault();isDragging=true;svg.classList.add("simple-commenter-icons-active");dragStartX=getClientX(e)-parseFloat(commentInputUI.style.left||0)||0;dragStartY=getClientY(e)-parseFloat(commentInputUI.style.top||0)||0;document.body.style.userSelect="none";document.body.style.touchAction="none";document.addEventListener("mousemove",dragElement);document.addEventListener("touchmove",dragElement,{passive:false});document.addEventListener("mouseup",stopDrag,{once:true});document.addEventListener("touchend",stopDrag,{once:true})};const dragElement=e=>{if(!isDragging)return;e.preventDefault();const newX=getClientX(e)-dragStartX;const newY=getClientY(e)-dragStartY;const viewportWidth=window.innerWidth;const viewportHeight=window.innerHeight;const elementWidth=commentInputUI.offsetWidth||360;const elementHeight=commentInputUI.offsetHeight||180;const maxX=viewportWidth-elementWidth;const maxY=viewportHeight-elementHeight;const boundedX=Math.max(0,Math.min(newX,maxX));const boundedY=Math.max(0,Math.min(newY,maxY));commentInputUI.style.left=`${boundedX}px`;commentInputUI.style.top=`${boundedY}px`};const stopDrag=()=>{isDragging=false;svg.classList.remove("simple-commenter-icons-active");document.removeEventListener("mousemove",dragElement);document.removeEventListener("touchmove",dragElement);document.body.style.userSelect="";document.body.style.touchAction=""};startDrag(event)}});const squareBtn=createIconButton({icon:"square",ariaLabel:"Draw Square",onClick:event=>{const svg=event.currentTarget.querySelector("svg");if(svg){document.body.style.cursor="crosshair";overlay.style.display="none";svg.classList.toggle("simple-commenter-icons-active");isDrawing=!isDrawing;currentTool=isDrawing?"square":null;if(isDrawing){document.addEventListener("mousedown",startDrawing);document.addEventListener("touchstart",startDrawing,{passive:false})}else{document.removeEventListener("mousedown",startDrawing);document.removeEventListener("touchstart",startDrawing)}}}});const circleBtn=createIconButton({icon:"circle",ariaLabel:"Draw Circle",onClick:event=>{const svg=event.currentTarget.querySelector("svg");if(svg){document.body.style.cursor="crosshair";overlay.style.display="none";svg.classList.toggle("simple-commenter-icons-active");isDrawing=!isDrawing;currentTool=isDrawing?"circle":null;if(isDrawing){document.addEventListener("mousedown",startDrawing);document.addEventListener("touchstart",startDrawing,{passive:false})}else{document.removeEventListener("mousedown",startDrawing);document.removeEventListener("touchstart",startDrawing)}}}});const lineBtn=createIconButton({icon:"line",ariaLabel:"Draw Line",onClick:event=>{const svg=event.currentTarget.querySelector("svg");if(svg){document.body.style.cursor="crosshair";overlay.style.display="none";svg.classList.toggle("simple-commenter-icons-active");isDrawing=!isDrawing;currentTool=isDrawing?"line":null;if(isDrawing){document.addEventListener("mousedown",startDrawing);document.addEventListener("touchstart",startDrawing,{passive:false})}else{document.removeEventListener("mousedown",startDrawing);document.removeEventListener("touchstart",startDrawing)}}}});const arrowBtn=createIconButton({icon:"arrow",ariaLabel:"Draw Arrow Line",onClick:event=>{const svg=event.currentTarget.querySelector("svg");if(svg){document.body.style.cursor="crosshair";overlay.style.display="none";svg.classList.toggle("simple-commenter-icons-active");isDrawing=!isDrawing;currentTool=isDrawing?"arrow":null;if(isDrawing){document.addEventListener("mousedown",startDrawing);document.addEventListener("touchstart",startDrawing,{passive:false})}else{document.removeEventListener("mousedown",startDrawing);document.removeEventListener("touchstart",startDrawing)}}}});const penBtn=createIconButton({icon:"pen",ariaLabel:"Draw Pen",onClick:event=>{const svg=event.currentTarget.querySelector("svg");if(svg){document.body.style.cursor="crosshair";overlay.style.display="none";svg.classList.toggle("simple-commenter-icons-active");isDrawing=!isDrawing;currentTool=isDrawing?"pen":null;if(isDrawing){document.addEventListener("mousedown",startDrawing);document.addEventListener("touchstart",startDrawing,{passive:false})}else{document.removeEventListener("mousedown",startDrawing);document.removeEventListener("touchstart",startDrawing)}}}});const visibleBtn=createIconButton({icon:"visible",ariaLabel:"Hide",onClick:()=>{toggleEyeButtons(visibleBtn,hideBtn);toggleCommentboxEyeVisiblity()}});const hideBtn=createIconButton({icon:"hidden",ariaLabel:"Visible",className:"simple-commenter-display-none",onClick:()=>{toggleEyeButtons(hideBtn,visibleBtn);toggleCommentboxEyeVisiblity()}});const backBtn=createIconButton({icon:"back",ariaLabel:"Back",onClick:()=>{if(shapes.length>0){const lastShape=shapes.pop();if(lastShape.element&&lastShape.element.parentNode){lastShape.element.parentNode.removeChild(lastShape.element)}redoShapes.push(lastShape);updateButtonStates()}}});const forwardBtn=createIconButton({icon:"forward",ariaLabel:"Forward",onClick:()=>{if(redoShapes.length>0){const nextShape=redoShapes.pop();document.body.appendChild(nextShape.element);shapes.push(nextShape);updateButtonStates()}}});let picker=null;let colorBtn=null;let colorSvg=null;picker=createColorPicker({colorSvg:colorSvg});colorBtn=createIconButton({icon:"color",ariaLabel:"Draw Circle",position:"relative",onClick:event=>{picker.classList.toggle("simple-commenter-display-none")}});const verticalLine=document.createElement("div");verticalLine.className="simple-commenter-vertical-line";moveContainer.appendChild(moveBtn);drawIconsContainer.appendChild(squareBtn);drawIconsContainer.appendChild(circleBtn);drawIconsContainer.appendChild(lineBtn);drawIconsContainer.appendChild(arrowBtn);drawIconsContainer.appendChild(penBtn);drawIconsContainer.appendChild(colorBtn);colorBtn.appendChild(picker);drawIconsContainer.appendChild(verticalLine);drawIconsContainer.appendChild(visibleBtn);drawIconsContainer.appendChild(hideBtn);drawIconsContainer.appendChild(backBtn);drawIconsContainer.appendChild(forwardBtn);header.appendChild(moveContainer);header.appendChild(titleContainer);header.appendChild(drawIconsContainer);header.appendChild(xButton);return{header:header,titleContainer:titleContainer,drawIconsContainer:drawIconsContainer,input:input}}function toggleEyeButtons(visibleButton,hiddenButton){visibleButton.classList.add("simple-commenter-display-none");hiddenButton.classList.remove("simple-commenter-display-none")}function toggleCommentboxEyeVisiblity(event,uiElement=commentInputUI){if(uiElement){const textarea=uiElement.querySelector("#simple-commenter-comment-textarea");const menu=uiElement.querySelector(".simple-commenter-comment-box-menu");if(textarea){textarea.classList.toggle("simple-commenter-display-none")}if(menu){menu.classList.toggle("simple-commenter-display-none")}}}function createCloseButton({ariaLabel:ariaLabel="Close",onClick:onClick}={}){const button=document.createElement("button");button.className="simple-commenter-x-button";button.setAttribute("aria-label",ariaLabel);const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("fill","none");svg.setAttribute("viewBox","0 0 24 24");svg.setAttribute("stroke-linecap","1.5");svg.setAttribute("stroke-linejoin","round");svg.setAttribute("stroke-width","1.5");svg.style.width="20px";svg.style.height="20px";svg.style.display="block";svg.innerHTML=` <path d="M6 18 18 6M6 6l12 12" /> `;button.appendChild(svg);button.addEventListener("click",(event=>{if(typeof onClick==="function"){onClick(event)}else{if(commentInputUI){resetCommentInput();resetShapes()}}}));return button}function resetCommentInput(){commentInputUI.remove();commentInputUI=null;screenshotData=null;removePulse()}let shapes=[];let redoShapes=[];let isDrawing=false;let currentShape=null;let justFinishedDrawing=false;let currentTool=null;function resetShapes(){shapes.forEach((shape=>{if(shape.element&&shape.element.parentNode){shape.element.parentNode.removeChild(shape.element)}}));shapes=[];redoShapes=[];isDrawing=false;currentShape=null;justFinishedDrawing=false;currentTool=null;document.removeEventListener("mousemove",drawShape);document.removeEventListener("mousedown",startDrawing);document.body.style.userSelect="";const toolButtons=document.querySelectorAll('.simple-commenter-comment-meta-button[aria-label^="Draw"]');toolButtons.forEach((btn=>{const svg=btn.querySelector("svg");if(svg)svg.classList.remove("simple-commenter-icons-active")}));updateButtonStates()}function startDrawing(event){const clickedElement=event.target;if(!isDrawing||!currentTool||clickedElement.closest(".simple-commenter-modebox"))return;event.preventDefault();const touch=event.type==="touchstart"?event.touches[0]:event;const startX=touch.clientX+window.scrollX;const startY=touch.clientY+window.scrollY;document.body.classList.add("simple-commenter-drawing-in-progress");let shapeElement;let currentShapeData={type:currentTool,startX:startX,startY:startY,selectedColorValue:selectedColorValue};const currentThemeColor=selectedColorValue||theme?.primary||"purple";if(currentTool==="pen"){shapeElement=document.createElementNS("http://www.w3.org/2000/svg","svg");shapeElement.setAttribute("class","simple-commenter-shape simple-commenter-pen");shapeElement.style.position="absolute";shapeElement.style.left=`${startX}px`;shapeElement.style.top=`${startY}px`;shapeElement.style.overflow="visible";shapeElement.style.pointerEvents="none";const pathElement=document.createElementNS("http://www.w3.org/2000/svg","path");const pathData=`M 0 0`;pathElement.setAttribute("d",pathData);pathElement.setAttribute("stroke",currentThemeColor);pathElement.style.pointerEvents="auto";shapeElement.appendChild(pathElement);document.body.appendChild(shapeElement);currentShapeData.element=shapeElement;currentShapeData.pathElement=pathElement;currentShapeData.pathData=pathData}else{shapeElement=document.createElement("div");shapeElement.className=`simple-commenter-shape simple-commenter-${currentTool}`;shapeElement.style.position="absolute";shapeElement.style.left=`${startX}px`;shapeElement.style.top=`${startY}px`;shapeElement.style.width="0px";shapeElement.style.height="0px";shapeElement.style.pointerEvents="none";switch(currentTool){case"square":case"circle":shapeElement.style.borderColor=currentThemeColor;break;case"line":shapeElement.style.backgroundColor=currentThemeColor;break;case"arrow":shapeElement.classList.add("simple-commenter-arrow-custom");shapeElement.style.setProperty("--theme-color",currentThemeColor);shapeElement.style.backgroundColor=currentThemeColor;break}document.body.appendChild(shapeElement);currentShapeData.element=shapeElement}currentShape=currentShapeData;document.body.style.userSelect="none";document.body.style.touchAction="none";document.addEventListener("mousemove",drawShape);document.addEventListener("touchmove",drawShape,{passive:false});document.addEventListener("mouseup",finishDrawing,{once:true});document.addEventListener("touchend",finishDrawing,{once:true})}function drawShape(event){if(!currentShape)return;event.preventDefault();const touch=event.type==="touchmove"?event.touches[0]:event;const currentX=touch.clientX+window.scrollX;const currentY=touch.clientY+window.scrollY;const width=currentX-currentShape.startX;const height=currentY-currentShape.startY;const absWidth=Math.abs(width);const absHeight=Math.abs(height);if(currentShape.type==="square"){currentShape.element.style.width=`${absWidth}px`;currentShape.element.style.height=`${absHeight}px`}else if(currentShape.type==="circle"){currentShape.element.style.width=`${absWidth}px`;currentShape.element.style.height=`${absHeight}px`}else if(currentShape.type==="line"){const length=Math.sqrt(width*width+height*height);const angle=Math.atan2(height,width)*(180/Math.PI);currentShape.element.style.left=`${currentShape.startX}px`;currentShape.element.style.top=`${currentShape.startY}px`;currentShape.element.style.width=`${length}px`;currentShape.element.style.height="2px";currentShape.element.style.transform=`rotate(${angle}deg)`;currentShape.element.style.transformOrigin="top left"}else if(currentShape.type==="arrow"){const length=Math.sqrt(width*width+height*height);const angle=Math.atan2(height,width)*(180/Math.PI);currentShape.element.style.left=`${currentShape.startX}px`;currentShape.element.style.top=`${currentShape.startY}px`;currentShape.element.style.width=`${length}px`;currentShape.element.style.height="2px";currentShape.element.style.transform=`rotate(${angle}deg)`;currentShape.element.style.transformOrigin="top left"}else if(currentShape.type==="pen"){const initialLeft=currentShape.element.style.left;const initialTop=currentShape.element.style.top;const relativeX=currentX-currentShape.startX;const relativeY=currentY-currentShape.startY;currentShape.pathData+=` L ${relativeX} ${relativeY}`;currentShape.pathElement.setAttribute("d",currentShape.pathData);if(currentShape.element.style.left!==initialLeft||currentShape.element.style.top!==initialTop){console.error("SVG element position changed during pen draw!","Before:",initialLeft,initialTop,"After:",currentShape.element.style.left,currentShape.element.style.top)}}if(width<0&&currentShape.type!=="line"&&currentShape.type!=="arrow"&&currentShape.type!=="pen"){currentShape.element.style.left=`${currentShape.startX-absWidth}px`}if(height<0&&currentShape.type!=="line"&&currentShape.type!=="arrow"&&currentShape.type!=="pen"){currentShape.element.style.top=`${currentShape.startY-absHeight}px`}}function finishDrawing(event){if(currentShape){shapes.push(currentShape);redoShapes=[];const shapeElement=currentShape.element;shapeElement.style.pointerEvents="auto";let isDraggingShape=false;let dragStartX,dragStartY;shapeElement.addEventListener("mousedown",handleShapeDragStart);shapeElement.addEventListener("touchstart",handleShapeDragStart,{passive:false});function handleShapeDragStart(e){if(!isDrawing){e.preventDefault();const touch=e.type==="touchstart"?e.touches[0]:e;isDraggingShape=true;dragStartX=touch.clientX+window.scrollX-parseFloat(shapeElement.style.left||0);dragStartY=touch.clientY+window.scrollY-parseFloat(shapeElement.style.top||0);document.body.style.userSelect="none";document.body.style.touchAction="none";document.addEventListener("mousemove",dragShape);document.addEventListener("touchmove",dragShape,{passive:false});document.addEventListener("mouseup",stopDraggingShape,{once:true});document.addEventListener("touchend",stopDraggingShape,{once:true})}}function dragShape(e){if(!isDraggingShape)return;e.preventDefault();const touch=e.type==="touchmove"?e.touches[0]:e;const newX=touch.clientX+window.scrollX-dragStartX;const newY=touch.clientY+window.scrollY-dragStartY;shapeElement.style.left=`${newX}px`;shapeElement.style.top=`${newY}px`}function stopDraggingShape(){isDraggingShape=false;document.removeEventListener("mousemove",dragShape);document.removeEventListener("touchmove",dragShape);document.body.style.userSelect="";document.body.style.touchAction="auto"}shapes.forEach((shape=>{shape.element.style.cursor=""}));currentShape=null;document.removeEventListener("mousemove",drawShape);document.removeEventListener("touchmove",drawShape);document.body.style.userSelect="";document.body.style.touchAction="auto";isDrawing=false;currentTool=null;document.body.style.cursor="default";document.removeEventListener("mousedown",startDrawing);document.removeEventListener("touchstart",startDrawing);const toolButtons=document.querySelectorAll('.simple-commenter-comment-meta-button[aria-label^="Draw"]');toolButtons.forEach((btn=>{const svg=btn.querySelector("svg");if(svg)svg.classList.remove("simple-commenter-icons-active")}));justFinishedDrawing=true;setTimeout((()=>{justFinishedDrawing=false}),100);updateButtonStates()}}function updateButtonStates(){const backButtons=document.querySelectorAll('.simple-commenter-comment-meta-button[aria-label="Back"]');const forwardButtons=document.querySelectorAll('.simple-commenter-comment-meta-button[aria-label="Forward"]');backButtons.forEach((backBtn=>{const backBtnSvg=backBtn.querySelector("svg");if(backBtnSvg){if(shapes.length>0){backBtnSvg.classList.remove("simple-commenter-btn-unavailable")}else{backBtnSvg.classList.add("simple-commenter-btn-unavailable")}}}));forwardButtons.forEach((forwardBtn=>{const forwardBtnSvg=forwardBtn.querySelector("svg");if(forwardBtnSvg){if(redoShapes.length>0){forwardBtnSvg.classList.remove("simple-commenter-btn-unavailable")}else{forwardBtnSvg.classList.add("simple-commenter-btn-unavailable")}}}))}function captureScreenshot(){return new Promise(((resolve,reject)=>{capturing=true;overlay.style.display="none";commentInputUI.style.display="none";const options={video:{displaySurface:"browser"},audio:false,preferCurrentTab:true,selfBrowserSurface:"include",systemAudio:"exclude",surfaceSwitching:"exclude",monitorTypeSurfaces:"exclude"};navigator.mediaDevices.getDisplayMedia(options).then((stream=>{const video=document.createElement("video");video.srcObject=stream;video.onloadedmetadata=()=>{video.play();const canvas=document.createElement("canvas");canvas.width=window.innerWidth;canvas.height=window.innerHeight;const context=canvas.getContext("2d");video.onplay=()=>{context.drawImage(video,0,0,canvas.width,canvas.height);const base64image=canvas.toDataURL("image/jpeg");const base64imageSmall=canvas.toDataURL("image/jpeg",.1);screenshotData={imgLarge:base64image,imgSmall:base64imageSmall};capturing=null;overlay.style.display="block";commentInputUI.style.display="block";const sizeInKB=base64image.length*3/4/1024;const smallSizeInKB=base64imageSmall.length*3/4/1024;stream.getTracks().forEach((track=>track.stop()));resolve({imgLarge:base64image,imgSmall:base64imageSmall})}};video.onerror=()=>{console.error("Video loading failed");capturing=null;overlay.style.display="block";commentInputUI.style.display="block";resetShapes();reject(new Error("Video loading failed"))}})).catch((err=>{console.error("Video loading failed");capturing=null;overlay.style.display="block";commentInputUI.style.display="block";resetShapes();console.error("Screen capture failed:",err);reject(err)}))}))}function showScreenshotGallery({screenshot:screenshot}){if(!screenshot){return}const galleryModal=document.createElement("div");galleryModal.className="simple-commenter-gallery-modal";const backdrop=document.createElement("div");backdrop.className="simple-commenter-gallery-backdrop";document.body.appendChild(backdrop);galleryModal.after(backdrop);const img=document.createElement("img");img.src=screenshot.imgLarge;img.alt="Captured Screenshot";img.className="simple-commenter-gallery-image";const closeButton=createCloseButton({icon:"x",ariaLabel:"Close Screenshot Gallery",onClick:()=>{galleryModal.remove();backdrop.remove()}});closeButton.className="simple-commenter-gallery-close";galleryModal.appendChild(img);galleryModal.appendChild(closeButton);document.body.appendChild(galleryModal)}const observer=new MutationObserver((mutations=>{mutations.forEach((mutation=>{if(mutation.type==="childList"&&mutation.addedNodes.length>0){mutation.addedNodes.forEach((node=>{if(node.tagName==="IMG"){node.removeAttribute("onerror")}}))}}))}));const observerConfig={childList:true,subtree:true};observer.observe(document.body,observerConfig);window.addEventListener("load",(function(){fetchData()}));window.addEventListener("popstate",(function(event){comments=[];fetchData()}))})();